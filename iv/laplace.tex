\chapter{L'equazione di Laplace}
\newcommand{\sfl}{\Lambda} % Soluzione fondamentale dell'equazione di Laplace
Sia $\Omega\subseteq\R^n$ aperto, e $f\in\cont[2]{\Omega}$ una funzione a valori reali.
L'equazione di Laplace per $f$ è l'equazione differenziale alle derivate parziali
\begin{equation}
    \lap f=0
    \label{eq:laplace}
\end{equation}
che è del secondo ordine, ellittica e omogenea.
Le soluzioni di questa equazione sono dette \emph{funzioni armoniche} (sull'insieme $\Omega$).
Soluzioni banali di questa equazione sono le funzioni costanti o quelle lineari/affini, che sono anche le \emph{uniche} soluzioni se il problema è unidimensionale; un po' meno banali sono i cosiddetti ``polinomi armonici'', come ad esempio un polinomio della forma $\frac12x_1^2-\frac12x_2^2$ più termini di grado minore.

Sia $\sfl\colon\R^n\setminus\{\vec 0\}\to\R$ la funzione
\begin{equation}
    \sfl(\vec x)=
    \begin{cases}
        -\frac1{2\pi}\log\norm{\vec x}      & n=2\\
        \frac1{n(2-n)\omega_n}\norm{\vec x}^{2-n}  & n\ge 3
    \end{cases}
    \label{eq:soluzione-fondamentale-laplace}
\end{equation}
dove
\begin{equation}
    \omega_n\defeq\frac{\pi^{n/2}}{\Gamma\bigl(\frac{n}2+1\bigr)}
    \label{eq:volume-palla-unitaria}
\end{equation}
è il volume della palla unitaria $n$-dimensionale $B^n$.
Ignoriamo il caso $n=1$, per cui si ritrova un'equazione differenziale ordinaria, che è tanto banale da non essere di alcun interesse.

Chiamiamo la funzione $\sfl$ \emph{soluzione fondamentale} dell'equazione di Laplace: verifichiamo che ne è una soluzione.
\begin{equation}
    \begin{gathered}
        \drp{}{x_i}\sfl(\vec x)=\frac1{n\omega_n}\norm{\vec x}^{-n}x_i\\
        \frac{\partial^2}{\partial x_i\partial x_j}\sfl(\vec x)=\frac1{n\omega_n}(\norm{\vec x}^2\delta_{ij}-nx_ix_j)\norm{\vec x}^{-n}
    \end{gathered}
\end{equation}
da cui
\begin{multline}
    \lap\sfl(\vec x)=
    \sum_{i=1}^n\frac{\partial^2}{\partial x_i^2}\sfl(\vec x)=
    \sum_{i=1}^n\frac1{n\omega_n}(\norm{\vec x}^2-nx_i^2)\norm{\vec x}^{-n}=\
    \frac1{n\omega_n\norm{\vec x}^n}\biggl(n\norm{\vec x}^2-n\sum_{i=1}^nx_i^2\biggr)=
    0
\end{multline}
quindi $\sfl$ è armonica in $\R^n\setminus\{\vec 0\}$.
Notiamo subito la simmetria sferica dell'equazione: se $A$ è una matrice $n\times n$ ortogonale e $f$ è armonica, allora anche $f\circ A$ è armonica nel medesimo insieme.
Per questo motivo, dato che $\sfl$ è in realtà funzione solo della norma del suo argomento, talvolta commetteremo un abuso di notazione scrivendo $\sfl(r)$ per $r\in\R$, intendendo che applichiamo $\sfl$ a un vettore di norma $r$ (la direzione di tale vettore, come abbiamo appena detto, non è importante); il significato sarà ogni volta chiaro dal contesto.
È ragionevole dunque cercare una soluzione che sia radiale: in coordinate sferiche, con $r\defeq\norm{\vec x}$, la \eqref{eq:laplace} per funzioni radiali si riscrive come
\begin{equation}
    u''(r)+\frac{n-1}{r}u'(r)=0,
\end{equation}
che è un'equazione particolarmente comoda da risolvere, a meno di due costanti arbitrarie da determinare.

\section{Formula di rappresentazione di Green}
Considieriamo d'ora in poi un insieme $\Omega\subseteq\R^n$ aperto.
\begin{definizione} \label{d:bordo-liscio}
    La frontiera $\boundary\Omega$ di $\Omega$ è detta di classe $\cclass[k]$, per un $k\in\N_0$, se per ogni $\vec x_0\in\boundary\Omega$ esistono $r>0$ e $\gamma\colon\R^{n-1}\to\R$ di classe $\cclass[k]$ tale che
    \begin{equation}
        \Omega\cap B_r(\vec x_0)=\{\vec x\in B_r(\vec x_0)\colon x_n>\gamma(x_1,\dotsc,x_{n-1})\}.
    \end{equation}
\end{definizione}
\begin{definizione} \label{d:derivata-normale}
    Sia $\boundary\Omega$ di classe $\cclass[1]$: data una funzione $u\in\cont[1]{E}$ con $E\supset\clos{\Omega}$ definiamo la \emph{derivata normale} come
    \begin{equation}
        \drp{u}{\nu}\defeq\scalar{\vnu}{\grad u}
        \label{eq:derivata-normale}
    \end{equation}
    dove $\vnu(\vec x)$ è il versore normale a $\boundary\Omega$ nel punto $\vec x$.
\end{definizione}
Sappiamo dal teorema della divergenza che per un campo vettoriale $\vec f\in\cont[1]{E}$ con $E\supset\clos{\Omega}$ aperto vale
\begin{equation}
    \int_\Omega\div f\,\dd\mu=\int_{\boundary\Omega} \scalar{\vec f}{\vnu}\,\dd\sigma
\end{equation}
dove $\dd\sigma$ è la misura di Lebesgue su $\boundary\Omega$, e abbiamo inoltre le formule di Green
\begin{gather}
    \int_\Omega (\phi\lap\psi+\scalar{\grad\phi}{\grad\psi})\,\dd\mu=\int_{\boundary\Omega} \psi\drp{\phi}{\nu}\,\dd\sigma \label{eq:green1}\\
    \int_\Omega (\psi\lap\phi+\phi\lap\psi)\,\dd\mu=\int_{\boundary\Omega} \biggl(\psi\drp{\phi}{\nu}-\phi\drp{\psi}{\nu}\biggr)\,\dd\sigma. \label{eq:green2}
\end{gather}

\begin{teorema} \label{t:rappresentazione-green}
    Sia $u\in\cont[2]{E}$ con $E\supset\clos{\Omega}$ aperto: per ogni $\vec y\in\Omega$ vale la relazione\footnote{
        In questi integrali la variabile di integrazione è $\vec x$, mentre $\vec y$ è fissa; evidenzieremo (qui e d'ora in poi) questo fatto indicando la variabile opportuna nella misura di integrazione, ossia ad esempio $\dd\mu(\vec x)$ anzich\'e solamente $\dd\mu$.
    }
    \begin{equation}
        u(\vec y)=
        \int_{\boundary\Omega} \biggl[u(\vec x)\drp{\sfl(\vec x-\vec y)}{\nu_\vec{x}}-\sfl\drp{u(\vec x)}{\nu_\vec{x}}\biggr]\,\dd\sigma(\vec x)+
        \int_\Omega \sfl(\vec x-\vec y)\lap u(\vec x)\,\dd\mu(\vec x).
        \label{eq:rappresentazione-green}
    \end{equation}
\end{teorema}
\begin{proof}
    Sia $\epsilon>0$, e consideriamo un intorno $B_\epsilon(\vec y)\subset\Omega$.
    Per la seconda formula di Green \eqref{eq:green2}, applicata sull'insieme $\Omega\setminus B_\epsilon(\vec y)$ (poich\'e $\sfl(\vec x-\vec y)$ è singolare se $\vec x=\vec y$; altrove è armonica) troviamo
    \begin{multline}
        \int_{\Omega\setminus B_\epsilon(\vec y)} \sfl(\vec x-\vec y)\lap u(\vec x)\,\dd\mu(\vec x)=\\=
        \int_{\boundary\Omega} \biggl[\sfl(\vec x-\vec y)\drp{u}{\nu}(\vec x)-u(\vec x)\drp{\sfl}{\nu}(\vec x-\vec y)\biggr]\,\dd\sigma(\vec x)-
        \int_{\boundary B_\epsilon(\vec y)} \biggl[\sfl(\vec x-\vec y)\drp{u}{\nu}(\vec x)-u(\vec x)\drp{\sfl}{\nu}(\vec x-\vec y)\biggr]\,\dd\sigma(\vec x).
    \end{multline}
    Al limite $\epsilon\to 0^+$, vediamo che $\lap u$ rimane limitata in $\clos{\Omega}$ poich\'e $u\in\cont[2]{E}$, mentre $\sfl$ è sommabile, dunque
    \begin{equation}
        \lim_{\epsilon\to 0^+}\int_{\Omega\setminus B_\epsilon(\vec y)} \sfl(\vec x-\vec y)\lap u(\vec x)\,\dd\mu(\vec x)=
    \end{equation}
    Su $\boundary B_\epsilon(\vec y)$ abbiamo che $\norm{\vec x-\vec y}=\epsilon$, di conseguenza $\sfl(\vec x-\vec y)=\sfl(\epsilon)\sim\epsilon^{2-n}$, mentre la derivata normale di $u$ rimane limitata per la regolarità della funzione, come prima: allora
    \begin{multline}
        \abs[\bigg]{\int_{\boundary B_\epsilon(\vec y)} \sfl(\vec x-\vec y)\drp{u}{\nu}(\vec x)\,\dd\sigma(\vec x)}\le
        \frac1{\epsilon^{n-2}}\sup_{\vec x\in\boundary B_\epsilon(\vec y)}\abs[\bigg]{\drp{u}{\nu}(\vec x)}\int_{\boundary B_\epsilon(\vec y)}\dd\sigma(\vec x)\le\\\le
        \frac1{\epsilon^{n-2}}c\int_{\boundary B_\epsilon(\vec y)}\dd\sigma(\vec x)=
        \frac1{\epsilon^{n-2}}cn\omega_n\epsilon^{n-1}=
        cn\omega_n\epsilon\to 0
    \end{multline}
    per $\epsilon\to 0^+$, mentre
    \begin{equation}
        \int_{\boundary B_\epsilon(\vec y)} u(\vec x)\drp{\sfl}{\nu}(\vec x-\vec y)\,\dd\sigma(\vec x)=
        \drp{\sfl}{\epsilon}(\vepsilon)\int_{\boundary B_\epsilon(\vec y)} u(\vec x)\,\dd\sigma(\vec x)=
        \frac1{n\omega_n\epsilon^{n-1}} \int_{\boundary B_\epsilon(\vec y)}u(\vec x)\,\dd\sigma(\vec x)
    \end{equation}
    e siccome il denominatore è la misura di $\boundary B_\epsilon(\vec y)$ e $u\in\cont[][\big]{\boundary B_\epsilon(\vec y)}$, questo termine è il valore medio di $u$ in $\boundary B_\epsilon(\vec y)$, che per $\epsilon\to 0^+$ tende dunque a $u(\vec y)$.
    Di conseguenza
    \begin{equation}
        u(\vec y)=
        \int_{\boundary\Omega}\biggl[u(\vec x)\drp{\sfl}{\nu}(\vec x-\vec y)-\sfl(\vec x-\vec y)\drp{u}{\nu}(\vec x)\biggr]\,\dd\sigma(\vec x)+
        \int_\Omega \sfl(\vec x-\vec y)\lap u(\vec x)\,\dd\mu(\vec x).\qedhere
    \end{equation}
\end{proof}
Se inoltre $u\in\contsc[\infty]{\Omega}$, allora è nulla sul bordo e il primo integrale è zero, e otteniamo
\begin{equation}
    u(\vec y)=\int_\Omega \sfl(\vec x-\vec y)\lap u(\vec x)\,\dd\mu(\vec x);
\end{equation}
integrando per parti, tramite la seconda identità di Green \eqref{eq:green2} scambiamo le derivate (il laplaciano è sempre una derivata sulle variabili $\vec x$) ottenendo infine
\begin{equation}
    u(\vec y)=\int_\Omega \lap\sfl(\vec x-\vec y)u(\vec x)\,\dd\mu(\vec x)
    \label{eq:laplace-delta}
\end{equation}
da cui vediamo che, come distribuzione, $\lap\sfl(\vec x-\vec y)=\delta(\vec x-\vec y)$.

Ecco due conseguenze di questa formula.
\begin{itemize}
    \item Se $u$ è armonica, allora in tutto $\Omega$ è univocamente determinata dai valori che assume su $\boundary\Omega$; in ogni caso è determinata da $u$ e $\drp{u}{\nu}$ su $\boundary\Omega$. % E il laplaciano?
    \item Viceversa, possiamo assegnare una qualsiasi condizione al contorno su $\boundary\Omega$ per determinare univocamente una soluzione?
        No, se vogliamo assegnare arbitrariamente allo stesso momento sia $u$ che $\drp{u}{\nu}$: è sufficiente infatti specificarne uno dei due.
\end{itemize}

\begin{definizione} \label{d:funzione-green}
    Sia $\Omega\subseteq\R^n$ aperto.
    Una funzione $G(\vec x,\vec y)$ definita su $\Omega\times\Omega$ tranne che per $\vec x=\vec y$ a valori in $\R$ è detta \emph{funzione di Green} per $\Omega$ se:
    \begin{itemize}
        \item $G(\vec x,\vec y)=0$ se $\vec x\in\boundary\Omega$;
        \item la funzione $G(\vec x,\vec y)-\sfl(\vec x-\vec y)$ è armonica per ogni $\vec x\in\Omega$ (anche per $\vec x=\vec y$).
    \end{itemize}
\end{definizione}
Evidentemente $G$ deve mostrare la stessa singolarità di $\sfl$ in $\vec x=\vec y$, affinch\'e le due si cancellino per dare una funzione armonica.
Sia dunque $G$ una funzione di Green in $\Omega$: fissiamo $\vec y\in\Omega$ e poniamo $v(\vec x)\defeq G(\vec x,\vec y)-\sfl(\vec x-\vec y)$.
Dalla seconda identità di Green \eqref{eq:green2} si ottiene, per una funzione $u$ armonica in $\Omega$ (come lo è $v$)
\begin{equation}
    0=\int_\Omega (v\lap u-u\lap v)\,\dd\mu=\int_{\boundary\Omega}\biggl(v\drp{u}{\nu}-u\drp{v}{\nu}\biggr)\,\dd\sigma
\end{equation}
ma per la formula di rappresentazione \eqref{eq:rappresentazione-green}
\begin{equation}
    u(\vec y)=\int_{\boundary\Omega}\biggl(u\drp{\sfl}{\nu}-\sfl\drp{u}{\nu}\biggr)\,\dd\sigma+\int_\Omega \sfl\lap u\,\dd\mu
\end{equation}
perciò prendendone la differenza abbiamo
\begin{multline}
        u(\vec y)=
        \int_{\boundary\Omega} \biggl(u\drp{\sfl}{\nu}-\sfl\drp{u}{\nu}\biggr)\,\dd\sigma-\int_{\boundary\Omega}\biggl[(G-\sfl)\drp{u}{\nu}-u\drp{G}{\nu}+u\drp{\sfl}{\nu}\biggr]\,\dd\sigma=\\=
        \int_{\boundary\Omega} \biggl(u\drp{G}{\nu}-G\drp{u}{\nu}\biggr)\,\dd\sigma=
        \int_{\boundary\Omega} u\drp{G}{\nu}\,\dd\sigma,
\end{multline}
siccome $G$ è nulla se $\vec x\in\boundary\Omega$, che mostra come $u$ sia determinata unicamente dai valori che assume su $\boundary\Omega$.
Analogamente si può creare un'altra funzione di Green $\tilde{G}$ per $\Omega$, tale che sia definita ancora per $\vec x\ne\vec y$ ma stavolta con $\drp{\tilde{G}}{\nu}=1$ per $\vec x\in\boundary\Omega$, e tale che $\tilde{G}-\sfl$ sia armonica in tutto $\Omega$.
Ricalcando i calcoli precedenti si ottiene stavolta
\begin{equation}
    u(\vec y)=
    \int_{\boundary\Omega} u\,\dd\sigma-\int_{\boundary\Omega}\tilde{G}\drp{u}{\nu}\,\dd\sigma+\int_\Omega\tilde{G}\lap u\,\dd\mu.
\end{equation}

Diamo uno sguardo all'unicità delle soluzioni: se $u_1$ e $u_2$ sono funzioni armoniche su $\Omega$ tali che $\drp{u_1}{\nu}=\drp{u_2}{\nu}$ su $\boundary\Omega$, allora $u_1-u_2$ è ancora armonica e soddisfa $\drp{(u_1-u_2)}{\nu}=0$ sul bordo.
Di conseguenza nell'equazione precedente rimane
\begin{equation}
    u_1(\vec y)-u_2(\vec y)=\int_{\boundary\Omega}(u_1-u_2)\,\dd\sigma
\end{equation}
da cui otteniamo che $u_1-u_2$ è costante.

Il problema di trovare una soluzione conoscendo la funzione sul bordo è noto come \emph{problema di Dirichlet}; se invece è nota la derivata normale, \emph{problema di Neumann}.

Determiniamo ora la funzione di Green sulla palla $B_R(\vec 0)$, di raggio $R$.
Definiamo la mappa di ``riflessione alla frontiera''
\begin{equation}
    \vec y\mapsto\bar{\vec y}\defeq
    \begin{cases}
        \frac{R^2}{\norm{\vec y}^2}\vec y & \vec y\ne\vec 0\\
        \infty                            & \vec y=\vec 0
    \end{cases}
    \label{eq:riflessione-frontiera}
\end{equation}
che opera una sorta di riflessione di un punto attraverso la superficie $\boundary B_R(\vec 0)$; notiamo che $\bar{\vec x}=\vec x$ se $\norm{\vec x}=R$ e che $\bar{\bar{\vec y}}=\vec y$.
Per $\vec x\in B_R(\vec 0)$ sia
\begin{equation}
    G(\vec x,\vec y)=
    \begin{cases}
        \sfl(\vec x-\vec y)-\sfl\Bigl(\frac{\norm{\vec y}}{R}(\vec x-\bar{\vec y})\Bigr) & \vec x\ne\vec y\\
        \sfl(\vec x)-\sfl(R)                                                             & \vec x=\vec y
    \end{cases}
\end{equation}
e controlliamo che sia una funzione di Green per $B_R(\vec 0)$.
Se $\vec x\ne\vec y$, $G$ è una differenza di due funzioni armoniche dunque essa stessa è armonica; se poi $\vec y\in B_R(\vec 0)$, allora $\bar{\vec y}\notin B_R(\vec 0)$ quindi $G$ possiede un'unica singolarità in tale insieme, poich\'e solo per uno dei due termini la variabile può essere nulla, ossia non può verificarsi sia che $\vec x=\vec y$ sia che $\vec x=\bar{\vec y}$.
Inoltre la funzione $G-\sfl=-\sfl\bigl(\frac{\norm{\vec y}}{R}(\vec x-\bar{\vec y})\bigr)$ è armonica in tutta $B_R(\vec 0)$.

Ora, per $\vec x\in\boundary B_R(\vec 0)$, ossia $\norm{\vec x}=R$, espandendo la norma della differenza troviamo, dato che $\norm{\bar{\vec y}}=R^2/\norm{\vec y}$,
\begin{equation}
    \begin{split}
        G(\vec x,\vec y)&=
        \sfl\bigl(\sqrt{\norm{\vec x}^2+\norm{\vec y}^2-2\scalar{\vec x}{\vec y}}\bigr)-\sfl\biggl(\frac{\norm{\vec y}}{R}\sqrt{\norm{\vec x}^2+\norm{\hat{\vec y}}^2-\scalar{\vec x}{\hat{\vec y}}}\biggr)=\\&=
        \sfl\bigl(\sqrt{R^2+\norm{\vec y}^2-2\scalar{\vec x}{\vec y}}\bigr)-\sfl\biggl(\sqrt{\frac{\norm{\vec x}^2\norm{\vec y}^2}{R^2}+R^2-\scalar{\vec x}{\hat{\vec y}}}\biggr)=\\&=
        \sfl\bigl(\sqrt{R^2+\norm{\vec y}^2-2\scalar{\vec x}{\vec y}}\bigr)-\sfl\biggl(\sqrt{\norm{\vec y}^2+R^2-\scalar{\vec x}{\hat{\vec y}}}\biggr)=
        0
    \end{split}
\end{equation}
dunque $G$ è una funzione di Green per $B_R(\vec 0)$.
\begin{esempio} \label{es:funzione-green-semipiano}
    Una funzione di Green per il semipiano $\{\vec x\in\R^n\colon x_1>0\}$ si costruisce in modo analogo, questa volta con la riflessione data dalla mappa $(x_1,x_2,\dotsc,x_n)\mapsto(-x_1,x_2,\dotsc,x_n)$.
\end{esempio}
\begin{osservazione} \label{o:funzione-green-simmetrica}
    La funzione di Green costruita per $B_r(\vec 0)$ è evidentemente simmetrica nelle due variabili, inoltre non è negativa in $B_R(\vec 0)$: per vederlo è sufficiente mostrare che $\norm{\vec x-\vec y}\le\frac{\norm{\vec y}}{R}\norm{\vec x-\bar{\vec y}}$.
    Questa disuguaglianza è equivalente a
    \begin{equation}
        \norm{\vec x}^2+\norm{\vec y}\le\frac{\norm{\vec x}^2\norm{\vec y}^2}{R^2}+R^2
        \qqq
        \frac{\norm{\vec x}^2}{R^2}(R^2-\norm{\vec y})\le R^2-\norm{\vec y}^2
    \end{equation}
    che è vera se $\norm{\vec x}\le R$ ossia se $\vec x\in B_R(\vec 0)$.
\end{osservazione}
La derivata normale al bordo di $B_R(\vec 0)$ non è altro che la derivata nella direzione radiale, per la quale $\scalar{\vnu}{\grad u}=\drp{u}{r}$ dove $r=\norm{\vec x}$:
\begin{equation}
    \begin{split}
        \drp{G}{\nu}(\vec x,\vec y)&=
        \drp{}{r}\biggl[\sfl\Bigl(\sqrt{\norm{\vec x}^2+\norm{\vec y}^2-2\scalar{\vec x}{\vec y}}\Bigr)-\sfl\biggl(\sqrt{\frac{\norm{\vec x}\norm{\vec y}}{R^2}+R^2-2\scalar{\vec x}{\vec y}}\biggr)\biggr]=\\&=
        \drp{}{r}\frac{\bigl(\norm{\vec x}^2+\norm{\vec y}^2-2\scalar{\vec x}{\vec y}\bigr)^\frac{2-n}{n}}{n(2-n)\omega_n}-\drp{}{r}\frac{\bigl(\norm{\vec x}^2\norm{\vec y}^2/R^2+R^2-2\scalar{\vec x}{\vec y}\bigr)^\frac{2-n}{n}}{n(2-n)\omega_n}=\\&=
        \frac1{2n\omega_n}\bigl(\norm{\vec x}^2\norm{\vec y}^2-2\scalar{\vec x}{\vec y}\bigr)^{-n}\biggl[2\norm{\vec x}-\drp{}{r}(2\scalar{\vec x}{\vec y})\biggr]-\frac1{2n\omega_n}\biggl(\frac{\norm{\vec x}^2\norm{\vec y}^2}{R^2}+R^2-2\scalar{\vec x}{\vec y}\biggr)^{-n}\biggl[2\frac{\norm{\vec x}\norm{\vec y}^2}{R^2}-\drp{}{r}(2\scalar{\vec x}{\vec y})\biggr]=\\&=
        \frac1{2n\omega_n}\biggl(2\norm{\vec x-\vec y}^{-n}\norm{\vec x}-2\norm{\vec x-\vec y}^{-n}\frac{\norm{\vec y}}{R}\biggr)=\\&=
        \frac{R^2-\norm{\vec y}^2}{n\omega_nR^2\norm{\vec x-\vec y}^2}.
    \end{split}
\end{equation}
Avevamo visto che se $u$ è armonica in $\Omega$ allora $u(\vec y)=\int_{\boundary\Omega} u(\vec x)\drp{G}{\nu}(\vec x,\vec y)\,\dd\sigma(\vec x)$: per $\Omega=B_R(\vec 0)$ si ha allora
\begin{equation}
    u(\vec y)=\frac{R^2-\norm{\vec y}^2}{n\omega_nR}\int_{\boundary B_R(\vec 0)}\frac{u(\vec x)}{\norm{\vec x-\vec y}^n}\,\dd\sigma(\vec x).
    \label{eq:rappresentazione-green-palla}
\end{equation}
Ci chiediamo ora l'inverso, ossia se ogni funzione costruita in questo modo è armonica.
\begin{teorema} \label{t:laplace-rappresentazione-poisson}
    Dato il problema di Dirichlet in $B_R(\vec 0)$
    \begin{equation}
        \begin{cases}
            \lap u=0 & x\in B_R(\vec 0)\\
            u=\phi   & x\in\boundary B_R(\vec 0)
        \end{cases}
    \end{equation}
    per una certa $\phi\in\cont{\boundary B_R(\vec 0)}$, sia $u\colon\clos{B_R(\vec 0)}\to\R$ la funzione definita da
    \begin{equation}
        u(\vec x)=\frac{R^2-\norm{\vec x}^2}{n\omega_n R}\int_{\boundary B_R(\vec 0)}\frac{\phi(\vec y)}{\norm{\vec x-\vec y}^n}\,\dd\sigma(\vec y)
    \end{equation}
    per $\vec x\in B_R(\vec 0)$ e da $u=\phi$ per $\vec x\in\boundary B_R(\vec 0)$.
    Allora la funzione $u$ è armonica in $B_R(\vec 0)$, ed è continua in $\clos{B_R(\vec 0)}$.
\end{teorema}
\begin{proof}
    Sappiamo che la funzione di Green $G$ per $B_R(\vec 0)$ è armonica in entrambe le variabili, e che
    \begin{equation}
        u(\vec y)=\int_{\boundary B_R(\vec 0)}u(\vec x)\drp{G}{\nu_{\vec x}}(\vec x,\vec y)\,\dd\sigma(\vec x).
    \end{equation}
    Dato che $\lap_{\vec y}G=0$, si ha ovviamente $\drp{}{\nu_{\vec x}}\lap_{\vec y}G=0$ da cui $\lap_y\drp{}{\nu_{\vec x}}G=0$.
    Pertanto il nucleo
    \begin{equation}
        K(\vec x,\vec y)=
        \drp{G}{\nu_{\vec x}}(\vec x,\vec y)=
        \frac{R^2-\norm{\vec x}^2}{n\omega_n R}\frac1{\norm{\vec x-\vec y}^n}
    \end{equation}
    dell'integrale è ancora armonico in $\vec y$, ossia $\lap_{\vec y}K=0$, e di conseguenza anche $u$ è armonica.

    Osserviamo ora che la funzione $\phi=1$ in $\clos{B_R(\vec 0)}$ è evidentemente armonica, quindi
    \begin{equation}
        1=
        \frac{R^2-\norm{\vec x}^2}{n\omega_n R}\int_{\boundary B_R(\vec 0)}\frac1{\norm{\vec x-\vec y}^n}\,\dd\sigma(\vec x)=
        \int_{\boundary B_R(\vec 0)}K(\vec x,\vec y)\,\dd\sigma(\vec x)
    \end{equation}
    per ogni $\vec y\in B_R(\vec 0)$.
    Sia $\vec y_0\in\boundary B_R(\vec 0)$: per la continuità di $\phi$, per ogni $\epsilon>0$ esiste $\delta>0$ tale che $\abs{\phi(\vec y)-\phi(\vec y_0)}<\epsilon/2$ per ogni $\vec y\in\boundary B_R(\vec 0)$ tale che $\norm{\vec y-\vec y_0}<2\delta$.
    Dato che $\boundary B_R(\vec 0)$ è compatto, si ha che
    \begin{equation}
        m\defeq
        \sup_{\boundary B_R(\vec 0)}\phi=
        \max_{\boundary B_R(\vec 0)}\phi<
        +\infty,
    \end{equation}
    e siccome
    \begin{equation}
        u(\vec y_0)=
        \phi(\vec y_0)=
        \phi(\vec y_0)\int_{\boundary B_R(\vec 0)}K(\vec x,\vec y)\,\dd\sigma(\vec x)=
        \int_{\boundary B_R(\vec 0)}K(\vec x,\vec y)\phi(\vec y_0)\,\dd\sigma(\vec x)
    \end{equation}
    risulta
    \begin{multline}
        \abs{u(\vec y)-u(\vec y_0)}=
        \abs[\bigg]{\int_{\boundary B_R(\vec 0)}K(\vec x,\vec y)\bigl[\phi(\vec x)-\phi(\vec y_0)\bigr]\,\dd\sigma(\vec x)}\le\\\le
        \int_{\{\vec x\in\boundary B_R(\vec 0)\colon \norm{\vec x-\vec y_0}<2\delta\}}K(\vec x,\vec y)\abs{\phi(\vec x)-\phi(\vec y_0)}\,\dd\sigma(\vec x)+\\+
        \int_{\{\vec x\in\boundary B_R(\vec 0)\colon \norm{\vec x-\vec y_0}\ge 2\delta\}}K(\vec x,\vec y)\abs{\phi(\vec x)-\phi(\vec y_0)}\,\dd\sigma(\vec x).
    \end{multline}
    Ora, per $\vec x\in B_R(\vec 0)$ e $\norm{\vec x-\vec y_0}<2\delta$ si ha $\abs{\phi(\vec x)-\phi(\vec y_0)}<\epsilon/2$ dunque il primo addendo è minore anch'esso di $\epsilon/2$, dato che $K$ è positiva e l'integrale è solo su una parte di $\boundary B_R(\vec 0)$; per il secondo addendo, $\abs{\phi(\vec x)-\phi(\vec y_0)}\ge 2m$ perciò
    \begin{equation}
        \abs{u(\vec y)-u(\vec y_0)}\le
        \frac{\epsilon}2+2m\frac{R^2-\norm{\vec x}^2}{n\omega_n R}\int_{\{\vec x\in\boundary B_R(\vec 0)\colon \norm{\vec x-\vec y_0}\ge 2\delta\}}\frac1{\norm{\vec x-\vec y}^n}\,\dd\sigma(\vec x).
    \end{equation}
    Per $\norm{\vec x-\vec y_0}\ge 2\delta$ vale comunque, per $\norm{\vec y-\vec y_0}<\delta$, che $\norm{\vec x-\vec y}\ge\norm{\vec x-\vec y_0}-\norm{\vec y_0-\vec y}\ge 2\delta-\delta=\delta$ quindi
    \begin{equation}
        \frac1{\norm{\vec x-\vec y}^n}\le\frac1{\delta^n}
        \qqq
        \abs{u(\vec y)-u(\vec y_0)}\le
        \frac{\epsilon}2+2m\frac{R^2-\norm{\vec x}^2}{n\omega_n R}\frac1{\delta^n}n\omega_n R^{n-1}.
    \end{equation}
    Al limite per $\norm{\vec y}\to R$ si ha $\abs{R-\norm{\vec y}}\le\tilde{\delta}$ e l'ultimo termine rimane minore di $\epsilon/2$, quindi $\abs{u(\vec y)-u(\vec y_0)}\le\epsilon$ che prova che $u$ è continua in $B_R(\vec 0)$.
\end{proof}

\section{Formule del valor medio}
Definiamo le seguenti notazioni per indicare la media integrale di una funzione sulla palla $B_R(\vec x)$, per un $\vec x\in\R^n$, o la sua frontiera:
\begin{equation}
    \avint_{B_R(\vec x)}u\,\dd\mu\defeq\frac1{\omega R^n}\int_{B_R(\vec x)}u\,\dd\mu
    \qquad
    \avint_{\boundary B_R(\vec x)}u\,\dd\sigma\defeq\frac1{n\omega_nR^{n-1}}\int_{\boundary B_R(\vec x)}u\,\dd\sigma.
\end{equation}
\begin{teorema} \label{t:valor-medio-laplace}
    Se $u\in\cont[2]{\Omega}$ è armonica allora, per ogni $R$ tale che $B_R(\vec x)\subset\Omega$,
    \begin{equation}
        u(\vec x)=\avint_{\boundary B_R(\vec x)} u\,\dd\sigma=\avint_{B_R(\vec x)} u\,\dd\mu.
    \end{equation}
\end{teorema}
\begin{proof}
    Senza perdere generalità possiamo assumere che $\vec x=0$.
    Tramite la formula di Poisson in $\vec y=0$ abbiamo che
    \begin{equation}
        u(\vec 0)=\frac{R^2}{n\omega_n R}\int_{\boundary B_R(\vec 0)}\frac{u(\vec x)}{\norm{\vec x}^n}\,\dd\sigma(\vec x)
    \end{equation}
    per cui, siccome $\norm{\vec x}=R$ sul bordo,
    \begin{equation}
        u(\vec 0)=\frac1{n\omega_n R^{n-1}}\int_{\boundary B_R(\vec 0)}u\,\dd\sigma
    \end{equation}
    che dimostra la prima uguaglianza.
    
    Per la seconda, invece, integrando radialmente si ha
    \begin{multline}
        \int_{B_R(\vec 0)} u\,\dd\mu=
        \int_0^R\int_{\boundary B_s(\vec 0)} u\,\dd\sigma\,\dd s=
        \int_0^R n\omega_n s^{n-1}\avint_{\boundary B_s(\vec 0)} u\,\dd\sigma\,\dd s=\\=
        u(\vec 0)n\omega_n \int_0^R s^{n-1}\,\dd s=
        u(\vec 0)n\omega_n\frac{R^n}{n}
    \end{multline}
    da cui otteniamo
    \begin{equation}
        u(\vec 0)=\frac1{\omega_nR^n}\avint_{B_R(\vec 0)} u\,\dd\mu.\qedhere
    \end{equation}
\end{proof}
Vale anche l'inverso, ossia, una funzione che possiede questa proprietà del valor medio è armonica?
S\`i, come vediamo nel seguente teorema.
\begin{teorema} \label{t:valor-medio-armonicità}
    Se $u\in\cont[2]{\Omega}$ è tale che $u(\vec y)=\avint_{\boundary B_R(\vec y)} u\,\dd\sigma$ per ogni $R$ tale che $B_R(\vec y)\subset\Omega$, allora $u$ è armonica.
\end{teorema}
\begin{proof}
    Supponiamo che $u$ non sia armonica, ossia che esista $\vec x\in\Omega$ tale che $\lap u(\vec x)\ne 0$, e assumiamo (senza perdere generalità) che $\lap u(\vec x)>0$.
    Siccome $u\in\cont[2]{\Omega}$, il suo laplaciano è continuo dunque esiste $r$ tale per cui $\lap u(\bar{\vec x})>0$ per ogni $\bar{\vec x}\in B_r(\vec x)\subset\Omega$.
    Sia $R>r$, e definiamo, con una traslazione da $\vec x$ a $\vec 0$,
    \begin{equation}
        \phi(R)\defeq\avint_{\boundary B_R(\vec 0)} u\,\dd\sigma.
    \end{equation}
    Effettuiamo una traslazione delle coordinate nell'origine, con $\vec x=\vec y+R\vec z$ e $\norm{\vec z}=1$ ottenendo
    \begin{equation}
        \phi(R)=\avint_{\boundary B_1(\vec 0)}u(\vec y+R\vec z)\,\dd\sigma(\vec z).
    \end{equation}
    Ora, $\phi$ è costante, poich\'e per il teorema del valore medio l'integrale nell'equazione precedente è sempre uguale a $u(\vec y)$: allora $\phi'(R)=0$, e cos\`i
    \begin{equation}
        0=
        \avint_{\boundary B_1(\vec 0)} \drv{}{R}u(\vec y+R\vec z)\,\dd\sigma(\vec z)=
        \avint_{\boundary B_1(\vec 0)} \scalar{\vec z}{\grad u(\vec y+R\vec z)}\,\dd\sigma(\vec z).
    \end{equation}
    Tornando alle variabili originarie,
    \begin{equation}
        0=
        \avint_{\boundary B_R(\vec y)} \scalar{\frac{\vec x-\vec y}{R}}{\grad u(\vec x)}\,\dd\sigma(\vec x)=
        \avint_{\boundary B_R(\vec y)} \scalar{\vnu}{\grad u}\,\dd\sigma=
        \avint_{\boundary B_R(\vec y)} \drp{u}{\nu}\,\dd\sigma
    \end{equation}
    e infine per il teorema della divergenza questo è uguale a
    \begin{equation}
        \frac1{n\omega_n R^{n-1}}\int_{B_R(\vec y)} \lap u\,\dd\mu
    \end{equation}
    che è positivo, poich\'e $B_R(\vec y)$ contiene $B_r(\vec y)$ dove $\lap u$ è positivo.
    Questo contraddice le ipotesi, quindi $u$ deve essere armonica.
\end{proof}
