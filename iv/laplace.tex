\chapter{L'equazione di Laplace}
\newcommand{\sfl}{\Lambda} % Soluzione fondamentale dell'equazione di Laplace
Sia $\Omega\subseteq\R^n$ aperto, e $f\in\cont[2]{\Omega}$ una funzione a valori reali.
L'equazione di Laplace per $f$ è l'equazione differenziale alle derivate parziali
\begin{equation}
    \lap f=0
    \label{eq:laplace}
\end{equation}
che è del secondo ordine, ellittica e omogenea.
Le soluzioni di questa equazione sono dette \emph{funzioni armoniche} (sull'insieme $\Omega$).
Soluzioni banali di questa equazione sono le funzioni costanti o quelle lineari/affini, che sono anche le \emph{uniche} soluzioni se il problema è unidimensionale; un po' meno banali sono i cosiddetti ``polinomi armonici'', come ad esempio un polinomio della forma $\frac12x_1^2-\frac12x_2^2$ più termini di grado minore.

Sia $\sfl\colon\R^n\setminus\{\vec 0\}\to\R$ la funzione
\begin{equation}
    \sfl(\vec x)=
    \begin{cases}
        -\frac1{2\pi}\log\norm{\vec x}      & n=2\\
        \frac1{n(2-n)\omega_n}\norm{\vec x}^{2-n}  & n\ge 3
    \end{cases}
    \label{eq:soluzione-fondamentale-laplace}
\end{equation}
dove
\begin{equation}
    \omega_n\defeq\frac{\pi^{n/2}}{\Gamma\bigl(\frac{n}2+1\bigr)}
    \label{eq:volume-palla-unitaria}
\end{equation}
è il volume della palla unitaria $n$-dimensionale $B^n$.
Ignoriamo il caso $n=1$, per cui si ritrova un'equazione differenziale ordinaria, che è tanto banale da non essere di alcun interesse.

Chiamiamo la funzione $\sfl$ \emph{soluzione fondamentale} dell'equazione di Laplace: verifichiamo che ne è una soluzione.
\begin{equation}
    \begin{gathered}
        \drp{}{x_i}\sfl(\vec x)=\frac1{n\omega_n}\norm{\vec x}^{-n}x_i\\
        \frac{\partial^2}{\partial x_i\partial x_j}\sfl(\vec x)=\frac1{n\omega_n}(\norm{\vec x}^2\delta_{ij}-nx_ix_j)\norm{\vec x}^{-n}
    \end{gathered}
\end{equation}
da cui
\begin{multline}
    \lap\sfl(\vec x)=
    \sum_{i=1}^n\frac{\partial^2}{\partial x_i^2}\sfl(\vec x)=
    \sum_{i=1}^n\frac1{n\omega_n}(\norm{\vec x}^2-nx_i^2)\norm{\vec x}^{-n}=\
    \frac1{n\omega_n\norm{\vec x}^n}\biggl(n\norm{\vec x}^2-n\sum_{i=1}^nx_i^2\biggr)=
    0
\end{multline}
quindi $\sfl$ è armonica in $\R^n\setminus\{\vec 0\}$.
Notiamo subito la simmetria sferica dell'equazione: se $A$ è una matrice $n\times n$ ortogonale e $f$ è armonica, allora anche $f\circ A$ è armonica nel medesimo insieme.
Per questo motivo, dato che $\sfl$ è in realtà funzione solo della norma del suo argomento, talvolta commetteremo un abuso di notazione scrivendo $\sfl(r)$ per $r\in\R$, intendendo che applichiamo $\sfl$ a un vettore di norma $r$ (la direzione di tale vettore, come abbiamo appena detto, non è importante); il significato sarà ogni volta chiaro dal contesto.
È ragionevole dunque cercare una soluzione che sia radiale: in coordinate sferiche, con $r\defeq\norm{\vec x}$, la \eqref{eq:laplace} per funzioni radiali si riscrive come
\begin{equation}
    u''(r)+\frac{n-1}{r}u'(r)=0,
\end{equation}
che è un'equazione particolarmente comoda da risolvere, a meno di due costanti arbitrarie da determinare.

\section{Formula di rappresentazione di Green}
Considieriamo d'ora in poi un insieme $\Omega\subseteq\R^n$ aperto.
\begin{definizione} \label{d:bordo-liscio}
    La frontiera $\boundary\Omega$ di $\Omega$ è detta di classe $\cclass[k]$, per un $k\in\N_0$, se per ogni $\vec x_0\in\boundary\Omega$ esistono $r>0$ e $\gamma\colon\R^{n-1}\to\R$ di classe $\cclass[k]$ tale che
    \begin{equation}
        \Omega\cap B_r(\vec x_0)=\{\vec x\in B_r(\vec x_0)\colon x_n>\gamma(x_1,\dotsc,x_{n-1})\}.
    \end{equation}
\end{definizione}
\begin{definizione} \label{d:derivata-normale}
    Sia $\boundary\Omega$ di classe $\cclass[1]$: data una funzione $u\in\cont[1]{E}$ con $E\supset\clos{\Omega}$ definiamo la \emph{derivata normale} come
    \begin{equation}
        \drp{u}{\nu}\defeq\scalar{\vnu}{\grad u}
        \label{eq:derivata-normale}
    \end{equation}
    dove $\vnu(\vec x)$ è il versore normale a $\boundary\Omega$ nel punto $\vec x$.
\end{definizione}
Sappiamo dal teorema della divergenza che per un campo vettoriale $\vec f\in\cont[1]{E}$ con $E\supset\clos{\Omega}$ aperto vale
\begin{equation}
    \int_\Omega\div f\,\dd\mu=\int_{\boundary\Omega} \scalar{\vec f}{\vnu}\,\dd\sigma
\end{equation}
dove $\dd\sigma$ è la misura di Lebesgue su $\boundary\Omega$, e abbiamo inoltre le formule di Green
\begin{gather}
    \int_\Omega (\phi\lap\psi+\scalar{\grad\phi}{\grad\psi})\,\dd\mu=\int_{\boundary\Omega} \psi\drp{\phi}{\nu}\,\dd\sigma \label{eq:green1}\\
    \int_\Omega (\psi\lap\phi+\phi\lap\psi)\,\dd\mu=\int_{\boundary\Omega} \biggl(\psi\drp{\phi}{\nu}-\phi\drp{\psi}{\nu}\biggr)\,\dd\sigma. \label{eq:green2}
\end{gather}

\begin{teorema} \label{t:rappresentazione-green}
    Sia $u\in\cont[2]{E}$ con $E\supset\clos{\Omega}$ aperto: per ogni $\vec y\in\Omega$ vale la relazione\footnote{
        In questi integrali la variabile di integrazione è $\vec x$, mentre $\vec y$ è fissa; evidenzieremo (qui e d'ora in poi) questo fatto indicando la variabile opportuna nella misura di integrazione, ossia ad esempio $\dd\mu(\vec x)$ anzich\'e solamente $\dd\mu$.
    }
    \begin{equation}
        u(\vec y)=
        \int_{\boundary\Omega} \biggl[u(\vec x)\drp{\sfl(\vec x-\vec y)}{\nu_\vec{x}}-\sfl\drp{u(\vec x)}{\nu_\vec{x}}\biggr]\,\dd\sigma(\vec x)+
        \int_\Omega \sfl(\vec x-\vec y)\lap u(\vec x)\,\dd\mu(\vec x).
        \label{eq:rappresentazione-green}
    \end{equation}
\end{teorema}
\begin{proof}
    Sia $\epsilon>0$, e consideriamo un intorno $B_\epsilon(\vec y)\subset\Omega$.
    Per la seconda formula di Green \eqref{eq:green2}, applicata sull'insieme $\Omega\setminus B_\epsilon(\vec y)$ (poich\'e $\sfl(\vec x-\vec y)$ è singolare se $\vec x=\vec y$; altrove è armonica) troviamo
    \begin{multline}
        \int_{\Omega\setminus B_\epsilon(\vec y)} \sfl(\vec x-\vec y)\lap u(\vec x)\,\dd\mu(\vec x)=\\=
        \int_{\boundary\Omega} \biggl[\sfl(\vec x-\vec y)\drp{u}{\nu}(\vec x)-u(\vec x)\drp{\sfl}{\nu}(\vec x-\vec y)\biggr]\,\dd\sigma(\vec x)-
        \int_{\boundary B_\epsilon(\vec y)} \biggl[\sfl(\vec x-\vec y)\drp{u}{\nu}(\vec x)-u(\vec x)\drp{\sfl}{\nu}(\vec x-\vec y)\biggr]\,\dd\sigma(\vec x).
    \end{multline}
    Al limite $\epsilon\to 0^+$, vediamo che $\lap u$ rimane limitata in $\clos{\Omega}$ poich\'e $u\in\cont[2]{E}$, mentre $\sfl$ è sommabile, dunque
    \begin{equation}
        \lim_{\epsilon\to 0^+}\int_{\Omega\setminus B_\epsilon(\vec y)} \sfl(\vec x-\vec y)\lap u(\vec x)\,\dd\mu(\vec x)=
    \end{equation}
    Su $\boundary B_\epsilon(\vec y)$ abbiamo che $\norm{\vec x-\vec y}=\epsilon$, di conseguenza $\sfl(\vec x-\vec y)=\sfl(\epsilon)\sim\epsilon^{2-n}$, mentre la derivata normale di $u$ rimane limitata per la regolarità della funzione, come prima: allora
    \begin{multline}
        \abs[\bigg]{\int_{\boundary B_\epsilon(\vec y)} \sfl(\vec x-\vec y)\drp{u}{\nu}(\vec x)\,\dd\sigma(\vec x)}\le
        \frac1{\epsilon^{n-2}}\sup_{\vec x\in\boundary B_\epsilon(\vec y)}\abs[\bigg]{\drp{u}{\nu}(\vec x)}\int_{\boundary B_\epsilon(\vec y)}\dd\sigma(\vec x)\le\\\le
        \frac1{\epsilon^{n-2}}c\int_{\boundary B_\epsilon(\vec y)}\dd\sigma(\vec x)=
        \frac1{\epsilon^{n-2}}cn\omega_n\epsilon^{n-1}=
        cn\omega_n\epsilon\to 0
    \end{multline}
    per $\epsilon\to 0^+$, mentre
    \begin{equation}
        \int_{\boundary B_\epsilon(\vec y)} u(\vec x)\drp{\sfl}{\nu}(\vec x-\vec y)\,\dd\sigma(\vec x)=
        \drp{\sfl}{\epsilon}(\vepsilon)\int_{\boundary B_\epsilon(\vec y)} u(\vec x)\,\dd\sigma(\vec x)=
        \frac1{n\omega_n\epsilon^{n-1}} \int_{\boundary B_\epsilon(\vec y)}u(\vec x)\,\dd\sigma(\vec x)
    \end{equation}
    e siccome il denominatore è la misura di $\boundary B_\epsilon(\vec y)$ e $u\in\cont[][\big]{\boundary B_\epsilon(\vec y)}$, questo termine è il valore medio di $u$ in $\boundary B_\epsilon(\vec y)$, che per $\epsilon\to 0^+$ tende dunque a $u(\vec y)$.
    Di conseguenza
    \begin{equation}
        u(\vec y)=
        \int_{\boundary\Omega}\biggl[u(\vec x)\drp{\sfl}{\nu}(\vec x-\vec y)-\sfl(\vec x-\vec y)\drp{u}{\nu}(\vec x)\biggr]\,\dd\sigma(\vec x)+
        \int_\Omega \sfl(\vec x-\vec y)\lap u(\vec x)\,\dd\mu(\vec x).\qedhere
    \end{equation}
\end{proof}
Se inoltre $u\in\contsc[\infty]{\Omega}$, allora è nulla sul bordo e il primo integrale è zero, e otteniamo
\begin{equation}
    u(\vec y)=\int_\Omega \sfl(\vec x-\vec y)\lap u(\vec x)\,\dd\mu(\vec x);
\end{equation}
integrando per parti, tramite la seconda identità di Green \eqref{eq:green2} scambiamo le derivate (il laplaciano è sempre una derivata sulle variabili $\vec x$) ottenendo infine
\begin{equation}
    u(\vec y)=\int_\Omega \lap\sfl(\vec x-\vec y)u(\vec x)\,\dd\mu(\vec x)
    \label{eq:laplace-delta}
\end{equation}
da cui vediamo che, come distribuzione, $\lap\sfl(\vec x-\vec y)=\delta(\vec x-\vec y)$.

Ecco due conseguenze di questa formula.
\begin{itemize}
    \item Se $u$ è armonica, allora in tutto $\Omega$ è univocamente determinata dai valori che assume su $\boundary\Omega$; in ogni caso è determinata da $u$ e $\drp{u}{\nu}$ su $\boundary\Omega$. % E il laplaciano?
    \item Viceversa, possiamo assegnare una qualsiasi condizione al contorno su $\boundary\Omega$ per determinare univocamente una soluzione?
        No, se vogliamo assegnare arbitrariamente allo stesso momento sia $u$ che $\drp{u}{\nu}$: è sufficiente infatti specificarne uno dei due.
\end{itemize}

\begin{definizione} \label{d:funzione-green}
    Sia $\Omega\subseteq\R^n$ aperto.
    Una funzione $G(\vec x,\vec y)$ definita su $\Omega\times\Omega$ tranne che per $\vec x=\vec y$ a valori in $\R$ è detta \emph{funzione di Green} per $\Omega$ se:
    \begin{itemize}
        \item $G(\vec x,\vec y)=0$ se $\vec x\in\boundary\Omega$;
        \item la funzione $G(\vec x,\vec y)-\sfl(\vec x-\vec y)$ è armonica per ogni $\vec x\in\Omega$ (anche per $\vec x=\vec y$).
    \end{itemize}
\end{definizione}
Evidentemente $G$ deve mostrare la stessa singolarità di $\sfl$ in $\vec x=\vec y$, affinch\'e le due si cancellino per dare una funzione armonica.
Sia dunque $G$ una funzione di Green in $\Omega$: fissiamo $\vec y\in\Omega$ e poniamo $v(\vec x)\defeq G(\vec x,\vec y)-\sfl(\vec x-\vec y)$.
Dalla seconda identità di Green \eqref{eq:green2} si ottiene, per una funzione $u$ armonica in $\Omega$ (come lo è $v$)
\begin{equation}
    0=\int_\Omega (v\lap u-u\lap v)\,\dd\mu=\int_{\boundary\Omega}\biggl(v\drp{u}{\nu}-u\drp{v}{\nu}\biggr)\,\dd\sigma
\end{equation}
ma per la formula di rappresentazione \eqref{eq:rappresentazione-green}
\begin{equation}
    u(\vec y)=\int_{\boundary\Omega}\biggl(u\drp{\sfl}{\nu}-\sfl\drp{u}{\nu}\biggr)\,\dd\sigma+\int_\Omega \sfl\lap u\,\dd\mu
\end{equation}
perciò prendendone la differenza abbiamo
\begin{multline}
        u(\vec y)=
        \int_{\boundary\Omega} \biggl(u\drp{\sfl}{\nu}-\sfl\drp{u}{\nu}\biggr)\,\dd\sigma-\int_{\boundary\Omega}\biggl[(G-\sfl)\drp{u}{\nu}-u\drp{G}{\nu}+u\drp{\sfl}{\nu}\biggr]\,\dd\sigma=\\=
        \int_{\boundary\Omega} \biggl(u\drp{G}{\nu}-G\drp{u}{\nu}\biggr)\,\dd\sigma=
        \int_{\boundary\Omega} u\drp{G}{\nu}\,\dd\sigma,
\end{multline}
siccome $G$ è nulla se $\vec x\in\boundary\Omega$, che mostra come $u$ sia determinata unicamente dai valori che assume su $\boundary\Omega$.
Analogamente si può creare un'altra funzione di Green $\tilde{G}$ per $\Omega$, tale che sia definita ancora per $\vec x\ne\vec y$ ma stavolta con $\drp{\tilde{G}}{\nu}=1$ per $\vec x\in\boundary\Omega$, e tale che $\tilde{G}-\sfl$ sia armonica in tutto $\Omega$.
Ricalcando i calcoli precedenti si ottiene stavolta
\begin{equation}
    u(\vec y)=
    \int_{\boundary\Omega} u\,\dd\sigma-\int_{\boundary\Omega}\tilde{G}\drp{u}{\nu}\,\dd\sigma+\int_\Omega\tilde{G}\lap u\,\dd\mu.
\end{equation}

Diamo uno sguardo all'unicità delle soluzioni: se $u_1$ e $u_2$ sono funzioni armoniche su $\Omega$ tali che $\drp{u_1}{\nu}=\drp{u_2}{\nu}$ su $\boundary\Omega$, allora $u_1-u_2$ è ancora armonica e soddisfa $\drp{(u_1-u_2)}{\nu}=0$ sul bordo.
Di conseguenza nell'equazione precedente rimane
\begin{equation}
    u_1(\vec y)-u_2(\vec y)=\int_{\boundary\Omega}(u_1-u_2)\,\dd\sigma
\end{equation}
da cui otteniamo che $u_1-u_2$ è costante.

Il problema di trovare una soluzione conoscendo la funzione sul bordo è noto come \emph{problema di Dirichlet}; se invece è nota la derivata normale, \emph{problema di Neumann}.

Determiniamo ora la funzione di Green sulla palla $B_R(\vec 0)$, di raggio $R$.
Definiamo la mappa di ``riflessione alla frontiera''
\begin{equation}
    \vec y\mapsto\bar{\vec y}\defeq
    \begin{cases}
        \frac{R^2}{\norm{\vec y}^2}\vec y & \vec y\ne\vec 0\\
        \infty                            & \vec y=\vec 0
    \end{cases}
    \label{eq:riflessione-frontiera}
\end{equation}
che opera una sorta di riflessione di un punto attraverso la superficie $\boundary B_R(\vec 0)$; notiamo che $\bar{\vec x}=\vec x$ se $\norm{\vec x}=R$ e che $\bar{\bar{\vec y}}=\vec y$.
Per $\vec x\in B_R(\vec 0)$ sia
\begin{equation}
    G(\vec x,\vec y)=
    \begin{cases}
        \sfl(\vec x-\vec y)-\sfl\Bigl(\frac{\norm{\vec y}}{R}(\vec x-\bar{\vec y})\Bigr) & \vec x\ne\vec y\\
        \sfl(\vec x)-\sfl(R)                                                             & \vec x=\vec y
    \end{cases}
\end{equation}
e controlliamo che sia una funzione di Green per $B_R(\vec 0)$.
Se $\vec x\ne\vec y$, $G$ è una differenza di due funzioni armoniche dunque essa stessa è armonica; se poi $\vec y\in B_R(\vec 0)$, allora $\bar{\vec y}\notin B_R(\vec 0)$ quindi $G$ possiede un'unica singolarità in tale insieme, poich\'e solo per uno dei due termini la variabile può essere nulla, ossia non può verificarsi sia che $\vec x=\vec y$ sia che $\vec x=\bar{\vec y}$.
Inoltre la funzione $G-\sfl=-\sfl\bigl(\frac{\norm{\vec y}}{R}(\vec x-\bar{\vec y})\bigr)$ è armonica in tutta $B_R(\vec 0)$.

Ora, per $\vec x\in\boundary B_R(\vec 0)$, ossia $\norm{\vec x}=R$, espandendo la norma della differenza troviamo, dato che $\norm{\bar{\vec y}}=R^2/\norm{\vec y}$,
\begin{equation}
    \begin{split}
        G(\vec x,\vec y)&=
        \sfl\bigl(\sqrt{\norm{\vec x}^2+\norm{\vec y}^2-2\scalar{\vec x}{\vec y}}\bigr)-\sfl\biggl(\frac{\norm{\vec y}}{R}\sqrt{\norm{\vec x}^2+\norm{\hat{\vec y}}^2-\scalar{\vec x}{\hat{\vec y}}}\biggr)=\\&=
        \sfl\bigl(\sqrt{R^2+\norm{\vec y}^2-2\scalar{\vec x}{\vec y}}\bigr)-\sfl\biggl(\sqrt{\frac{\norm{\vec x}^2\norm{\vec y}^2}{R^2}+R^2-\scalar{\vec x}{\hat{\vec y}}}\biggr)=\\&=
        \sfl\bigl(\sqrt{R^2+\norm{\vec y}^2-2\scalar{\vec x}{\vec y}}\bigr)-\sfl\biggl(\sqrt{\norm{\vec y}^2+R^2-\scalar{\vec x}{\hat{\vec y}}}\biggr)=
        0
    \end{split}
\end{equation}
dunque $G$ è una funzione di Green per $B_R(\vec 0)$.
\begin{esempio} \label{es:funzione-green-semipiano}
    Una funzione di Green per il semipiano $\{\vec x\in\R^n\colon x_1>0\}$ si costruisce in modo analogo, questa volta con la riflessione data dalla mappa $(x_1,x_2,\dotsc,x_n)\mapsto(-x_1,x_2,\dotsc,x_n)$.
\end{esempio}
\begin{osservazione} \label{o:funzione-green-simmetrica}
    La funzione di Green costruita per $B_r(\vec 0)$ è evidentemente simmetrica nelle due variabili, inoltre non è negativa in $B_R(\vec 0)$: per vederlo è sufficiente mostrare che $\norm{\vec x-\vec y}\le\frac{\norm{\vec y}}{R}\norm{\vec x-\bar{\vec y}}$.
    Questa disuguaglianza è equivalente a
    \begin{equation}
        \norm{\vec x}^2+\norm{\vec y}\le\frac{\norm{\vec x}^2\norm{\vec y}^2}{R^2}+R^2
        \qqq
        \frac{\norm{\vec x}^2}{R^2}(R^2-\norm{\vec y})\le R^2-\norm{\vec y}^2
    \end{equation}
    che è vera se $\norm{\vec x}\le R$ ossia se $\vec x\in B_R(\vec 0)$.
\end{osservazione}
La derivata normale al bordo di $B_R(\vec 0)$ non è altro che la derivata nella direzione radiale, per la quale $\scalar{\vnu}{\grad u}=\drp{u}{r}$ dove $r=\norm{\vec x}$:
\begin{equation}
    \begin{split}
        \drp{G}{\nu}(\vec x,\vec y)&=
        \drp{}{r}\biggl[\sfl\Bigl(\sqrt{\norm{\vec x}^2+\norm{\vec y}^2-2\scalar{\vec x}{\vec y}}\Bigr)-\sfl\biggl(\sqrt{\frac{\norm{\vec x}\norm{\vec y}}{R^2}+R^2-2\scalar{\vec x}{\vec y}}\biggr)\biggr]=\\&=
        \drp{}{r}\frac{\bigl(\norm{\vec x}^2+\norm{\vec y}^2-2\scalar{\vec x}{\vec y}\bigr)^\frac{2-n}{n}}{n(2-n)\omega_n}-\drp{}{r}\frac{\bigl(\norm{\vec x}^2\norm{\vec y}^2/R^2+R^2-2\scalar{\vec x}{\vec y}\bigr)^\frac{2-n}{n}}{n(2-n)\omega_n}=\\&=
        \frac1{2n\omega_n}\bigl(\norm{\vec x}^2\norm{\vec y}^2-2\scalar{\vec x}{\vec y}\bigr)^{-n}\biggl[2\norm{\vec x}-\drp{}{r}(2\scalar{\vec x}{\vec y})\biggr]-\frac1{2n\omega_n}\biggl(\frac{\norm{\vec x}^2\norm{\vec y}^2}{R^2}+R^2-2\scalar{\vec x}{\vec y}\biggr)^{-n}\biggl[2\frac{\norm{\vec x}\norm{\vec y}^2}{R^2}-\drp{}{r}(2\scalar{\vec x}{\vec y})\biggr]=\\&=
        \frac1{2n\omega_n}\biggl(2\norm{\vec x-\vec y}^{-n}\norm{\vec x}-2\norm{\vec x-\vec y}^{-n}\frac{\norm{\vec y}}{R}\biggr)=\\&=
        \frac{R^2-\norm{\vec y}^2}{n\omega_nR^2\norm{\vec x-\vec y}^2}.
    \end{split}
\end{equation}
Avevamo visto che se $u$ è armonica in $\Omega$ allora $u(\vec y)=\int_{\boundary\Omega} u(\vec x)\drp{G}{\nu}(\vec x,\vec y)\,\dd\sigma(\vec x)$: per $\Omega=B_R(\vec 0)$ si ha allora
\begin{equation}
    u(\vec y)=\frac{R^2-\norm{\vec y}^2}{n\omega_nR}\int_{\boundary B_R(\vec 0)}\frac{u(\vec x)}{\norm{\vec x-\vec y}^n}\,\dd\sigma(\vec x).
    \label{eq:rappresentazione-green-palla}
\end{equation}
Ci chiediamo ora l'inverso, ossia se ogni funzione costruita in questo modo è armonica.
\begin{teorema} \label{t:laplace-rappresentazione-poisson}
    Dato il problema di Dirichlet in $B_R(\vec 0)$
    \begin{equation}
        \begin{cases}
            \lap u=0 & x\in B_R(\vec 0)\\
            u=\phi   & x\in\boundary B_R(\vec 0)
        \end{cases}
    \end{equation}
    per una certa $\phi\in\cont{\boundary B_R(\vec 0)}$, sia $u\colon\clos{B_R(\vec 0)}\to\R$ la funzione definita da
    \begin{equation}
        u(\vec x)=\frac{R^2-\norm{\vec x}^2}{n\omega_n R}\int_{\boundary B_R(\vec 0)}\frac{\phi(\vec y)}{\norm{\vec x-\vec y}^n}\,\dd\sigma(\vec y)
    \end{equation}
    per $\vec x\in B_R(\vec 0)$ e da $u=\phi$ per $\vec x\in\boundary B_R(\vec 0)$.
    Allora la funzione $u$ è armonica in $B_R(\vec 0)$, ed è continua in $\clos{B_R(\vec 0)}$.
\end{teorema}
\begin{proof}
    Sappiamo che la funzione di Green $G$ per $B_R(\vec 0)$ è armonica in entrambe le variabili, e che
    \begin{equation}
        u(\vec y)=\int_{\boundary B_R(\vec 0)}u(\vec x)\drp{G}{\nu_{\vec x}}(\vec x,\vec y)\,\dd\sigma(\vec x).
    \end{equation}
    Dato che $\lap_{\vec y}G=0$, si ha ovviamente $\drp{}{\nu_{\vec x}}\lap_{\vec y}G=0$ da cui $\lap_y\drp{}{\nu_{\vec x}}G=0$.
    Pertanto il nucleo
    \begin{equation}
        K(\vec x,\vec y)=
        \drp{G}{\nu_{\vec x}}(\vec x,\vec y)=
        \frac{R^2-\norm{\vec x}^2}{n\omega_n R}\frac1{\norm{\vec x-\vec y}^n}
    \end{equation}
    dell'integrale è ancora armonico in $\vec y$, ossia $\lap_{\vec y}K=0$, e di conseguenza anche $u$ è armonica.

    Osserviamo ora che la funzione $\phi=1$ in $\clos{B_R(\vec 0)}$ è evidentemente armonica, quindi
    \begin{equation}
        1=
        \frac{R^2-\norm{\vec x}^2}{n\omega_n R}\int_{\boundary B_R(\vec 0)}\frac1{\norm{\vec x-\vec y}^n}\,\dd\sigma(\vec x)=
        \int_{\boundary B_R(\vec 0)}K(\vec x,\vec y)\,\dd\sigma(\vec x)
    \end{equation}
    per ogni $\vec y\in B_R(\vec 0)$.
    Sia $\vec y_0\in\boundary B_R(\vec 0)$: per la continuità di $\phi$, per ogni $\epsilon>0$ esiste $\delta>0$ tale che $\abs{\phi(\vec y)-\phi(\vec y_0)}<\epsilon/2$ per ogni $\vec y\in\boundary B_R(\vec 0)$ tale che $\norm{\vec y-\vec y_0}<2\delta$.
    Dato che $\boundary B_R(\vec 0)$ è compatto, si ha che
    \begin{equation}
        m\defeq
        \sup_{\boundary B_R(\vec 0)}\phi=
        \max_{\boundary B_R(\vec 0)}\phi<
        +\infty,
    \end{equation}
    e siccome
    \begin{equation}
        u(\vec y_0)=
        \phi(\vec y_0)=
        \phi(\vec y_0)\int_{\boundary B_R(\vec 0)}K(\vec x,\vec y)\,\dd\sigma(\vec x)=
        \int_{\boundary B_R(\vec 0)}K(\vec x,\vec y)\phi(\vec y_0)\,\dd\sigma(\vec x)
    \end{equation}
    risulta
    \begin{multline}
        \abs{u(\vec y)-u(\vec y_0)}=
        \abs[\bigg]{\int_{\boundary B_R(\vec 0)}K(\vec x,\vec y)\bigl[\phi(\vec x)-\phi(\vec y_0)\bigr]\,\dd\sigma(\vec x)}\le\\\le
        \int_{\{\vec x\in\boundary B_R(\vec 0)\colon \norm{\vec x-\vec y_0}<2\delta\}}K(\vec x,\vec y)\abs{\phi(\vec x)-\phi(\vec y_0)}\,\dd\sigma(\vec x)+\\+
        \int_{\{\vec x\in\boundary B_R(\vec 0)\colon \norm{\vec x-\vec y_0}\ge 2\delta\}}K(\vec x,\vec y)\abs{\phi(\vec x)-\phi(\vec y_0)}\,\dd\sigma(\vec x).
    \end{multline}
    Ora, per $\vec x\in B_R(\vec 0)$ e $\norm{\vec x-\vec y_0}<2\delta$ si ha $\abs{\phi(\vec x)-\phi(\vec y_0)}<\epsilon/2$ dunque il primo addendo è minore anch'esso di $\epsilon/2$, dato che $K$ è positiva e l'integrale è solo su una parte di $\boundary B_R(\vec 0)$; per il secondo addendo, $\abs{\phi(\vec x)-\phi(\vec y_0)}\ge 2m$ perciò
    \begin{equation}
        \abs{u(\vec y)-u(\vec y_0)}\le
        \frac{\epsilon}2+2m\frac{R^2-\norm{\vec x}^2}{n\omega_n R}\int_{\{\vec x\in\boundary B_R(\vec 0)\colon \norm{\vec x-\vec y_0}\ge 2\delta\}}\frac1{\norm{\vec x-\vec y}^n}\,\dd\sigma(\vec x).
    \end{equation}
    Per $\norm{\vec x-\vec y_0}\ge 2\delta$ vale comunque, per $\norm{\vec y-\vec y_0}<\delta$, che $\norm{\vec x-\vec y}\ge\norm{\vec x-\vec y_0}-\norm{\vec y_0-\vec y}\ge 2\delta-\delta=\delta$ quindi
    \begin{equation}
        \frac1{\norm{\vec x-\vec y}^n}\le\frac1{\delta^n}
        \qqq
        \abs{u(\vec y)-u(\vec y_0)}\le
        \frac{\epsilon}2+2m\frac{R^2-\norm{\vec x}^2}{n\omega_n R}\frac1{\delta^n}n\omega_n R^{n-1}.
    \end{equation}
    Al limite per $\norm{\vec y}\to R$ si ha $\abs{R-\norm{\vec y}}\le\tilde{\delta}$ e l'ultimo termine rimane minore di $\epsilon/2$, quindi $\abs{u(\vec y)-u(\vec y_0)}\le\epsilon$ che prova che $u$ è continua in $B_R(\vec 0)$.
\end{proof}

\section{Formule del valor medio}
Definiamo le seguenti notazioni per indicare la media integrale di una funzione sulla palla $B_R(\vec x)$, per un $\vec x\in\R^n$, o la sua frontiera:
\begin{equation}
    \avint_{B_R(\vec x)}u\,\dd\mu\defeq\frac1{\omega R^n}\int_{B_R(\vec x)}u\,\dd\mu
    \qquad
    \avint_{\boundary B_R(\vec x)}u\,\dd\sigma\defeq\frac1{n\omega_nR^{n-1}}\int_{\boundary B_R(\vec x)}u\,\dd\sigma.
\end{equation}
\begin{teorema} \label{t:valor-medio-laplace}
    Se $u\in\cont[2]{\Omega}$ è armonica allora, per ogni $R$ tale che $B_R(\vec x)\subset\Omega$,
    \begin{equation}
        u(\vec x)=\avint_{\boundary B_R(\vec x)} u\,\dd\sigma=\avint_{B_R(\vec x)} u\,\dd\mu.
    \end{equation}
\end{teorema}
\begin{proof}
    Senza perdere generalità possiamo assumere che $\vec x=0$.
    Tramite la formula di Poisson in $\vec y=0$ abbiamo che
    \begin{equation}
        u(\vec 0)=\frac{R^2}{n\omega_n R}\int_{\boundary B_R(\vec 0)}\frac{u(\vec x)}{\norm{\vec x}^n}\,\dd\sigma(\vec x)
    \end{equation}
    per cui, siccome $\norm{\vec x}=R$ sul bordo,
    \begin{equation}
        u(\vec 0)=\frac1{n\omega_n R^{n-1}}\int_{\boundary B_R(\vec 0)}u\,\dd\sigma
    \end{equation}
    che dimostra la prima uguaglianza.
    
    Per la seconda, invece, integrando radialmente si ha
    \begin{multline}
        \int_{B_R(\vec 0)} u\,\dd\mu=
        \int_0^R\int_{\boundary B_s(\vec 0)} u\,\dd\sigma\,\dd s=
        \int_0^R n\omega_n s^{n-1}\avint_{\boundary B_s(\vec 0)} u\,\dd\sigma\,\dd s=\\=
        u(\vec 0)n\omega_n \int_0^R s^{n-1}\,\dd s=
        u(\vec 0)n\omega_n\frac{R^n}{n}
    \end{multline}
    da cui otteniamo
    \begin{equation}
        u(\vec 0)=\frac1{\omega_nR^n}\avint_{B_R(\vec 0)} u\,\dd\mu.\qedhere
    \end{equation}
\end{proof}
Vale anche l'inverso, ossia, una funzione che possiede questa proprietà del valor medio è armonica?
S\`i, come vediamo nel seguente teorema.
\begin{teorema} \label{t:valor-medio-armonicità}
    Se $u\in\cont[2]{\Omega}$ è tale che $u(\vec y)=\avint_{\boundary B_R(\vec y)} u\,\dd\sigma$ per ogni $R$ tale che $B_R(\vec y)\subset\Omega$, allora $u$ è armonica.
\end{teorema}
\begin{proof}
    Supponiamo che $u$ non sia armonica, ossia che esista $\vec x\in\Omega$ tale che $\lap u(\vec x)\ne 0$, e assumiamo (senza perdere generalità) che $\lap u(\vec x)>0$.
    Siccome $u\in\cont[2]{\Omega}$, il suo laplaciano è continuo dunque esiste $r$ tale per cui $\lap u(\bar{\vec x})>0$ per ogni $\bar{\vec x}\in B_r(\vec x)\subset\Omega$.
    Sia $R>r$, e definiamo, con una traslazione da $\vec x$ a $\vec 0$,
    \begin{equation}
        \phi(R)\defeq\avint_{\boundary B_R(\vec 0)} u\,\dd\sigma.
    \end{equation}
    Effettuiamo una traslazione delle coordinate nell'origine, con $\vec x=\vec y+R\vec z$ e $\norm{\vec z}=1$ ottenendo
    \begin{equation}
        \phi(R)=\avint_{\boundary B_1(\vec 0)}u(\vec y+R\vec z)\,\dd\sigma(\vec z).
    \end{equation}
    Ora, $\phi$ è costante, poich\'e per il teorema del valore medio l'integrale nell'equazione precedente è sempre uguale a $u(\vec y)$: allora $\phi'(R)=0$, e cos\`i
    \begin{equation}
        0=
        \avint_{\boundary B_1(\vec 0)} \drv{}{R}u(\vec y+R\vec z)\,\dd\sigma(\vec z)=
        \avint_{\boundary B_1(\vec 0)} \scalar{\vec z}{\grad u(\vec y+R\vec z)}\,\dd\sigma(\vec z).
    \end{equation}
    Tornando alle variabili originarie,
    \begin{equation}
        0=
        \avint_{\boundary B_R(\vec y)} \scalar{\frac{\vec x-\vec y}{R}}{\grad u(\vec x)}\,\dd\sigma(\vec x)=
        \avint_{\boundary B_R(\vec y)} \scalar{\vnu}{\grad u}\,\dd\sigma=
        \avint_{\boundary B_R(\vec y)} \drp{u}{\nu}\,\dd\sigma
    \end{equation}
    e infine per il teorema della divergenza questo è uguale a
    \begin{equation}
        \frac1{n\omega_n R^{n-1}}\int_{B_R(\vec y)} \lap u\,\dd\mu
    \end{equation}
    che è positivo, poich\'e $B_R(\vec y)$ contiene $B_r(\vec y)$ dove $\lap u$ è positivo.
    Questo contraddice le ipotesi, quindi $u$ deve essere armonica.
\end{proof}

\begin{teorema} \label{t:principio-massimo-laplace}
    Se $u\in\cont[2]{\Omega}\cap\cont{\clos{\Omega}}$ è armonica su $\Omega$, allora essa assume il suo massimo su $\boundary\Omega$, vale a dire
    \begin{equation}
        \max_{\clos{\Omega}}u=\max_{\boundary\Omega}u.
    \end{equation}
    Se inoltre $\Omega$ è connesso ed esiste $\vec x_0\in\Omega$ tale che $u(\vec x_0)=\max_{\clos{\Omega}}u$, allora $u$ è costante su $\Omega$.
\end{teorema}
\begin{proof}
    (Dimostriamo solo la seconda affermazione, dato che essa implica la prima.)
    Sia $M\defeq\max_{\clos{\Omega}}u=u(\vec x_0)$, e $r\in\bigl(0,d(\vec x_0,\boundary\Omega)\bigr)$ con il quale costruiamo la palla $B_r(\vec x_0)\subset\Omega$.
    Per la proprietà del valor medio risulta
    \begin{equation}
        M=u(\vec x_0)=\avint_{B_r(\vec x_0)}u\,\dd\mu.
        \label{eq:dim-principio-massimo-locale}
    \end{equation}
    Poich\'e $u(\vec x)\le M$ per ogni $\vec x\in\Omega$, si deve avere $\avint_{B_r(\vec x_0)}u\,\dd\mu\le M$.
    Se però esistesse un punto $\vec x$ per il quale $u(\vec x)<M$, allora $\avint_{B_r(\vec x_0)}u\,\dd\mu$ sarebbe \emph{minore} di $M$, contraddicendo la \eqref{eq:dim-principio-massimo-locale}.
    Allora deve essere $u(\vec x)=M$ per ogni $\vec x\in B_r(\vec x_0)$: di conseguenza, l'insieme $P\defeq\{\vec x\in\Omega\colon u(\vec x)=M\}$ è sia aperto che chiuso in $\Omega$ (con la topologia indotta da $\R^n$) e siccome quest'ultimo è connesso, $P=\Omega$ provando cos\`i che $u$ è costante in $\Omega$.
\end{proof}

\begin{teorema} \label{t:unicità-problema-dirichlet-laplace}
    Se $\phi_1,\phi_2\in\cont[2]{\Omega}$ sono soluzioni del medesimo problema di Dirichlet in $\Omega$
    \begin{equation}
        \begin{cases}
            \lap u=0 \\
            u\bigr|_{\boundary\Omega}=g
        \end{cases}
    \end{equation}
    allora $\phi_1=\phi_2$ in $\Omega$.
\end{teorema}
\begin{proof}
    Mostriamo che $\phi_1\le\phi_2$ in $\Omega$ è una conseguenza di $\phi_1\le\phi_2$ in $\boundary\Omega$.
    Sia $v=\phi_1-\phi_2$: essa è soluzione del problema di Dirichlet con $\lap v=0$ in $\Omega$ e $v\le 0$ su $\boundary\Omega$ poich\'e $v$ deve assumere il massimo (che è pari a zero) sul bordo, dove $v=\phi_1-\phi_2\le 0$.
    Se poi $\phi_1=\phi_2$ su $\boundary\Omega$, allora su tale bordo si ha contemporaneamente che $\phi_1\le\phi_2$ e $\phi_1\ge\phi_2$, dunque si ha sia $v\le 0$ sia $v\ge 0$ su $\Omega$, vale a dire $v=0$ cioè $\phi_1=\phi_2$ su tutto $\Omega$.
\end{proof}
Il ragionamento di questa dimostrazione si applica ugualmente all'equazione di Poisson $\lap u=f$.

\section{Formulazione debole}
Consideriamo il problema di Dirichlet
\begin{equation}
    \begin{cases}
        \lap u=0 &\text{ in }\Omega\\
        u=f      &\text{ in }\boundary\Omega
    \end{cases}
    \label{eq:problema-dirichlet-laplace}
\end{equation}
per un dominio limitato $\Omega$ in $\R^n$, con bordo liscio, e con $u\in\cont[2]{\Omega}$.
\begin{teorema} \label{t:problema-dirichlet-laplace-variazionale}
    Una funzione $u\in\cont[2]{\Omega}$ è soluzione del problema di Dirichlet \eqref{eq:problema-dirichlet-laplace} se è tale che
    \begin{equation}
        \int_\Omega\norm{\grad u}^2\,\dd\mu=\min_{w\in\mathcal{W}}\biggl\{\int_\Omega\norm{\grad w}^2\,\dd\mu\biggr\}
    \end{equation}
    dove $\mathcal{W}=\{w\in\cont{\clos{\Omega}}\cap\cont[2]{\Omega}\text{ tali che }w\big|_{\boundary\Omega}=f\}$.
\end{teorema}
\begin{proof}
    Sia $\eta\in\contsc[\infty]{\Omega}$, e definiamo
    \begin{equation}
        \alpha\colon t\mapsto\int_\Omega\norm{\grad(u+t\eta)}^2\,\dd\mu,
    \end{equation}
    in altre parole facciamo variare $u$ con la funzione $t\eta$, che è compatibile con le condizioni al contorno del problema di Dirichlet poich\'e $(u+t\eta)\big|_{\boundary\Omega}=0$.
    Dato che per ipotesi il punto $t=0$ è di minimo per $\alpha$, abbiamo $\alpha'(0)=0$ da cui
    \begin{equation}
        0=
        \biggr(2\int_\Omega\scalar{\grad u}{\grad \eta}\,\dd\mu+2t\int_\Omega\norm{\grad \eta}^2\,\dd\mu\biggl)_{t=0}=
        2\int_\Omega\scalar{\grad u}{\grad\eta}\,\dd\mu.
    \end{equation}
    Dalla prima identità di Green \eqref{eq:green1} si ha perciò
    \begin{equation}
        0=
        \int_\Omega\scalar{\grad u}{\grad\eta}\,\dd\mu=
        -\int_\Omega\eta\lap u\,\dd\mu+\int_{\boundary\Omega}\eta\drp{u}{\nu}\,\dd\sigma
    \end{equation}
    da cui $\int_\Omega\eta\lap u\,\dd\mu=0$.
    Per il teorema \ref{t:fondamentale-calcolo-variazioni} concludiamo dunque che $\lap u=0$.
\end{proof}
Si può mostrare che il funzionale su $\cont[2]{\Omega}$
\begin{equation}
    u\mapsto \int_\Omega\norm{\grad u}^2\,\dd\mu
\end{equation}
è limitato dal basso, e questo può far pensare che il minimo sia sempre assunto per una funzione $\cclass[2]$, ma il seguente controesempio formulato da Weierstrass mostra che cos\`i non è.
Consideriamo $\Omega=(0,1)$, la misura $\dd\mu(x)=x^2\,\dd x$ e il funzionale
\begin{equation}
    \ell\colon u\mapsto \int_0^1 u'(x)^2\,\dd\mu(x)=\int_0^1u'(x)^2 x^2\,\dd x
    \label{eq:controesempio-weierstrass-dirichlet}
\end{equation}
da minimizzare nell'insieme delle funzioni $\mathcal{W}=\{w\in\cont{[0,1]}\cap\cont[2]{(0,1)}\text{ a tratti, tali che }w(0)=0, w(1)=1\}$.
Consideriamo la seguente successione $\{w_n\}_{n\in\N}\subset\mathcal{W}$:
\begin{equation}
    w_n(x)=
    \begin{cases}
        nx & 0\le x\le\frac1{n}\\
        1  & \frac1{n}< x\le 1
    \end{cases}.
\end{equation}
Chiaramente $\ell(w_n)\to 0$ per $n\to+\infty$, ma il limite di $w_n$, che è
\begin{equation}
    w(x)=
    \begin{cases}
        1 & x>0\\
        0 & x=0
    \end{cases}
\end{equation}
non è certo in $\mathcal{W}$.

Sia dunque $\Delta$ il funzionale
\begin{equation}
    \Delta\colon u\mapsto \int_\Omega\norm{\grad u}^2\,\dd\mu
\end{equation}
e consideriamo più in generale una successione $\{u_n\}_{n\in\N}$ minimizzante il problema di Dirichlet \eqref{eq:problema-dirichlet-laplace}, ossia tale che $\lim_{n\to +\infty}\Delta(u_n)=\min\Delta$.
Tale funzionale è convesso, poich\'e per $t\in[0,1]$ e due funzioni $u,v$
\begin{equation}
    \begin{split}
        \Delta\bigl(tu+(1-t)v\bigr)&=
        \int_\Omega\norm{t\grad u+(1-t)\grad v}^2\,\dd\mu=\\ &=
        \int_\Omega\bigl[t^2\norm{\grad u}^2+(1-t)^2\norm{\grad v}^2+2t(1-t)\scalar{\grad u}{\grad v}\bigr]\,\dd\mu\le\\ &\le
        \int_\Omega\bigl[t\norm{\grad u}^2+(1-t)\norm{\grad v}^2\bigr]\,\dd\mu=\\ &=
        t\Delta(u)+(1-t)\Delta(v)
    \end{split}
\end{equation}
e dunque per $n,m\in\N$ si ha
\begin{multline}
    \Delta(u_n-u_m)=
    \int_\Omega\norm{\grad(u_n-u_m)}^2\,\dd\mu=
    2\int_\Omega\bigl(\norm{\grad u_n}^2+\norm{\grad u_m}^2\bigr)\,\dd\mu-4\int_\Omega\norm[\bigg]{\grad\frac{u_n-u_m}2}^2\,\dd\mu=\\=
    2\Delta(u_n)+2\Delta(u_m)-4\Delta\biggl(\frac{u_n-u_m}2\biggr).
    \label{eq:funzionale-dirichlet-successione-cauchy}
\end{multline}
Risulta ovviamente $\min\Delta\le\Delta\bigl(\frac{u_n-u_m}2\bigr)$, e per la convessità vista sopra, preso $t=\frac12$, si ottiene $\Delta\bigl(\frac{u_n-u_m}2\bigr)\le\frac12\Delta(u_n)+\frac12\Delta(u_m)$.
Entrambi gli addendi di quest'ultimo membro, per $n,m\to+\infty$, tendono a $\min\Delta$, quindi sostituendo nella \eqref{eq:funzionale-dirichlet-successione-cauchy} risulta che $\Delta(u_n-u_m)\to 0$.
Siccome
\begin{multline}
    \Delta(u_n-u_m)=
    \int_\Omega\norm{\grad(u_n-u_m)}^2\,\dd\mu=
    \int_\Omega\sum_{i=1}^n\abs[\bigg]{\drp{}{x_i}(u_n-u_m)}^2\,\dd\mu=\\=
    \sum_{i=1}^n\int_\Omega\abs[\bigg]{\drp{}{x_i}(u_n-u_m)}^2\,\dd\mu=
    \sum_{i=1}^n\norm[\bigg]{\drp{u_n}{x_i}-\drp{u_m}{x_i}}_2^2
\end{multline}
si ha anche che $\drp{u_n}{x_i}$ forma una successione di Cauchy in $\leb[2]{\Omega}$, per $i\in\{1,\dotsc,n\}$, e per la completezza dello spazio tale successione converge\ldots\ a una funzione che è in $\leb[2]{\Omega}$, ma non è detto che sia anche solo continua.

In questo intervengono gli spazi di Sobolev e la formulazione debole del problema: partiamo più in generale dal problema di Dirichlet dell'equazione di Poisson
\begin{equation}
    \begin{cases}
        \lap u=f & \text{in }\Omega\\
        u=0      & \text{su }\boundary\Omega
    \end{cases}
    \label{eq:problema-dirichlet-equazione-poisson}
\end{equation}
per una $f\in\cont{\Omega}$.
Moltiplicando la prima per una funzione $\phi\in\contsc[\infty]{\Omega}$ e integrando per parti, siccome i termini di bordo si annullano, otteniamo
\begin{equation}
    \int_\Omega\scalar{\grad u}{\grad\phi}\,\dd\mu+\int_\Omega f\phi\,\dd\mu=0.
    \label{eq:problema-dirichlet-equazione-poisson-integrale}
\end{equation}
Ora formuliamo delle ipotesi più deboli sulle funzioni affinch\'e quest'ultima equazione abbia senso: assumeremo cos\`i che le soluzioni e le loro derivate siano in $\leb[2]{\Omega}$, cos\`i che l'equazione sopra sia ben definita e che possiamo lavorare in uno spazio di Hilbert.
Assumiamo dunque nella \eqref{eq:problema-dirichlet-equazione-poisson-integrale} che $u\in\sobH[1]{\Omega}$, e imponiamo la condizione al contorno $u=0$ dicendo ulteriormente che $u\in\sobHc[1]{\Omega}$.
A questo punto possiamo estendere, per continuità, l'integrale a sinistra anche a $\phi\in\sobHc[1]{\Omega}$.
L'integrale a destra allora ha senso non solo per $f\in\leb[2]{\Omega}$, ma più in generale per una $f$ nel duale di $\sobHc[1]{\Omega}$.
Per ora restiamo nelle ipotesi che $f\in\leb[2]{\Omega}$ e $u,\phi\in\sobH[1]{\Omega}$.

Fissata $f$, definiamo il funzionale $E_f\colon\sobHc[1]{\Omega}\to\R$ come
\begin{equation}
    E_f(u)=\frac12\int_\Omega\norm{\grad u}^2\,\dd\mu+\int_\Omega fu\,\dd\mu.
    \label{eq:funzionale-energia-poisson}
\end{equation}
L'integrale è ben definito poich\'e si ha
\begin{equation}
    \abs{E_f(u)}\le
    \frac12\norm{\grad u}_2^2+\norm{f}_2\norm{u}_2<
    +\infty
\end{equation}
con le ipotesi fatte.
Come già visto, la soluzione al problema di Dirichlet \eqref{eq:problema-dirichlet-equazione-poisson} è il punto di minimo di $E_f$ in $\sobHc[1]{\Omega}$, ma tale minimo viene poi assunto?
Innanzitutto vediamo che, con la norma $\norm{u}_{1,2}=\norm{\grad u}_2$ su $\sobHc[1]{\Omega}$,
\begin{equation}
    E_f(u)\ge
    \frac12\norm{u}_{1,2}^2-\norm{f}_2\norm{u}_2=
    \frac12\norm{u}_{1,2}^2-\frac1{\delta}\norm{f}_2\delta\norm{u}_2\ge
    \frac12\norm{u}_{1,2}^2-\frac12\biggl(\frac{\norm{f}_2}{\delta}\biggr)^2-\frac12(\delta\norm{u}_2)^2
\end{equation}
per ogni $\delta>0$, e con la disuguaglianza di Poincar\'e esiste $C>0$ per cui $\norm{u}_2\le C\norm{\grad u}_2$, quindi
\begin{equation}
    E_f(u)\ge
    \frac12\norm{u}_{1,2}^2-\frac12\biggl(\frac{\norm{f}_2}{\delta}\biggr)^2-\frac12(\delta C\norm{\grad u}_2)^2.
\end{equation}
Scegliendo $\delta^2=\frac1{2C^2}$ otteniamo allora
\begin{equation}
    E_f(u)\ge
    \frac12\norm{u}_{1,2}^2-\frac14\norm{u}_{1,2}^2-C^2\norm{f}_2^2=
    \frac14\norm{u}_{1,2}^2-C^2\norm{f}_2^2.
\end{equation}
Consideriamo dunque una successione $\{u_n\}_{n\in\N}\subset\sobHc[1]{\Omega}$ che minimizza $E_f$, cioè tale che per $n\to+\infty$ si abbia $E_f(u_n)\to\min E_f$.
Sia $m\defeq\min E_f$: esiste $\bar{m}\in\N$ tale che $\forall n>\bar{m}$ si ha $m\le E_f(u_n)\le m+1$, ossia
\begin{equation}
    m\le
    \frac12\int_\Omega\norm{\grad u_n}^2\,\dd\mu+\int_\Omega fu_n\,\dd\mu\le
    \frac12\int_\Omega\norm{\grad u_n}^2\,\dd\mu+\norm{f}_2\norm{u_n}_2\le
    m+1.
\end{equation}
Ciò significa che $\norm{\grad u_n}_2$ è limitata.
Dato che $\sobHc[1]{\Omega}$ è uno spazio di Hilbert riflessivo, esiste una sottosuccessione $\{u_{n_k}\}\subset\{u_n\}$ che converge debolmente a una $u\in\sobHc[1]{\Omega}$, % per quale teorema?
e per il teorema di Rellich-Kondrachov \ref{t:rellich-kondrachov} la sottosuccessione converge a $u$ anche in norma in $\leb[2]{\Omega}$, siccome $\sobHc[1]{\Omega}\cemb\leb[2]{\Omega}$.
Allora $u_{n_k}\weakto u$ anche in $\leb[2]{\Omega}$, e in particolare
\begin{equation}
    \int_\Omega fu_{n_k}\,\dd\mu\to\int_\Omega fu\,\dd\mu,
\end{equation}
e di conseguenza
\begin{equation}
    E_f(u_{n_k})=
    \frac12\int_\Omega\norm{\grad u_{n_k}}^2\,\dd\mu+\int_\Omega fu_{n_k}\,\dd\mu\to
    \frac12\int_\Omega\norm{\grad u}^2\,\dd\mu+\int_\Omega fu\,\dd\mu=
    m.
\end{equation}
D'ora in poi indichiamo la sottosuccessione con $u_n$.
Risulta
\begin{multline}
    0\le
    \int_\Omega\norm{\grad(u_n-u)}^2\,\dd\mu=
    \int_\Omega\bigl(\norm{\grad u_n}^2-2\scalar{\grad u}{\grad u_n}+\norm{\grad u_n}^2\bigr)\,\dd\mu=\\=
    \int_\Omega\norm{\grad u_n}^2\,\dd\mu-2\int_\Omega\scalar{\grad u}{\grad u_n}\,\dd\mu+\int_\Omega\norm{\grad u_n}^2\,\dd\mu.
\end{multline}
Ora, $\int_\Omega\scalar{\grad u}{\grad u_n}\,\dd\mu$ è un funzionale in $\sobHc[1]{\Omega}$ su $u_n$ che, per la convergenza debole della sottosuccessione, converge a $\int_\Omega\norm{\grad u}^2\,\dd\mu$, perciò al limite per $n\to+\infty$ otteniamo dalla disuguaglianza precedente
\begin{equation}
    \int_\Omega\norm{\grad u}^2\,\dd\mu \le \lim_{n\to+\infty}\int_\Omega\norm{\grad u_n}^2,
\end{equation}
perciò
\begin{equation}
    m-\int_\Omega fu\,\dd\mu=
    \lim_{n\to+\infty}\frac12\int_\Omega\norm{\grad u_n}^2\,\dd\mu\ge
    \frac12\int_\Omega\norm{\grad u_n}^2\,\dd\mu
\end{equation}
dalla quale otteniamo
\begin{equation}
    m\ge
    \frac12\int_\Omega\norm{\grad u}^2\,\dd\mu+\int_\Omega fu\,\dd\mu\ge
    m
\end{equation}
da cui è ovvio che
\begin{equation}
    m=\frac12\int_\Omega\norm{\grad u}^2\,\dd\mu+\int_\Omega fu\,\dd\mu=E_f(u)
\end{equation}
quindi il minimo è davvero assunto da una funzione in $\sobHc[1]{\Omega}$.

Inoltre, per tutte le derivate direzionali si ha
\begin{equation}
    E_f'(u)[\phi]=
    \lim_{t\to 0}\frac{E_f(u+t\phi)-E_f(u)}{t}=
    \int_\Omega\scalar{\grad u}{\grad\phi}\,\dd\mu+\int_\Omega f\phi\,\dd\mu=0
\end{equation}
per ogni $\phi\in\sobHc[1]{\Omega}$.
Anche la soluzione debole del problema di Dirichlet è unica: se $u_1$ e $u_2$ sono tali, allora $u_1-u_2$ soddisfa il problema \eqref{eq:problema-dirichlet-laplace} con condizioni al contorno omogenee, ossia $(u_1-u_2)\big|_{\boundary\Omega}=0$: di conseguenza
\begin{equation}
    \int_\Omega\scalar{\grad\phi}{\grad(u_1-u_2)}\,\dd\mu=0
\end{equation}
per ogni $\phi\in\sobHc[1]{\Omega}$ e in particolare scegliendo $\phi=u_1-u_2$ si ha $\norm{u_1-u_2}_{1,2}^2=0$, da cui $u_1=u_2$.

\section{Operatori ellittici del secondo ordine}
Possiamo generalizzare quanto detto finora ad operatori differenziali ellittici del secondo ordine.
Sia
\begin{equation}
    L\colon u\mapsto-\sum_{i=1}^n\sum_{j=1}^n\drp{}{x_i}\biggl(a_{ij}\drp{u}{x_j}\biggr)+c_0u
    \label{eq:operatore-ellittico-secondo-ordine}
\end{equation}
dove assumiamo che $a_{ij},c_0\in\leb[\infty]{\Omega}$, e tutte le derivate sono intese in senso debole.
Un tale operatore è detto \emph{in forma divergenza}.
L'operatore è ellittico se $\exists\lambda>0$ tale che
\begin{equation}
    \sum_{i=1}^n\sum_{j=1}^na_{ij}(\vec x)\xi_i\xi_j\ge\lambda\norm{\vxi}^2
\end{equation}
quasi ovunque in $\Omega$ e per ogni $\vxi\in\R^n$.
L'operatore laplaciano $-\lap$ è ellittico, con $a_{ij}=\delta_{ij}$.
Consideriamo dunque il problema
\begin{equation}
    \begin{cases}
        L(u)=f & \text{in }\Omega\\
        u=0    & \text{su }\boundary\Omega
    \end{cases}
    \label{eq:problema-dirichlet-ellittico-omogeneo}
\end{equation}
e definiamo una forma bilineare $a\colon\sobHc[1]{\Omega}\times\sobHc[1]{\Omega}\to\R$ da
\begin{equation}
    a(u,v)\defeq\int_\Omega\biggl(\sum_{i=1}^n\sum_{j=1}^na_{ij}\drp{u}{x_i}\drp{v}{x_j}+c_0uv\biggr)\,\dd\mu
    \label{eq:forma-bilineare-ellittica}
\end{equation}
Diciamo che $u\in\sobHc[1]{\Omega}$ è una soluzione debole di \eqref{eq:problema-dirichlet-ellittico-omogeneo} se $a(u,\phi)=\int_\Omega f\phi\,\dd\mu$ per ogni $\phi\in\sobHc[1]{\Omega}$.
\begin{proprieta} \label{pr:continuta-forma-bilineare-ellittica}
    La forma bilineare definita dalla \eqref{eq:forma-bilineare-ellittica} è continua in $\sobHc[1]{\Omega}\times\sobHc[1]{\Omega}$.
\end{proprieta}
\begin{proof}
    Per ogni $u,v\in\sobHc[1]{\Omega}$ si ha
    \begin{equation}
        \begin{split}
            \abs{a(u,v)}&\le
            \int_\Omega\biggl(\sum_{i=1}^n\sum_{j=1}^n\abs[\bigg]{a_{ij}\drp{u}{x_i}\drp{v}{x_j}}+\abs{c_0uv}\biggr)\,\dd\mu\le\\ &\le
            \sum_{i=1}^n\sum_{j=1}^n\biggl(\norm{a_{ij}}_\infty\norm[\bigg]{\drp{u}{x_i}}_2\norm[\bigg]{\drp{v}{x_j}}_2+\norm{c_0}_\infty\norm{u}_2\norm{v}_2\biggr)
        \end{split}
    \end{equation}
    con la disuguaglianza di Schwarz, mentre per la disuguaglianza di Poincar\'e esiste $c$ tale che $\norm{u}_2\le c\norm{\grad u}_2$, quindi
    \begin{equation}
        \begin{split}
            \abs{a(u,v)}&\le
            \sum_{i=1}^n\sum_{j=1}^n\biggl(\norm{a_{ij}}_\infty\norm[\bigg]{\drp{u}{x_i}}_2\norm[\bigg]{\drp{v}{x_j}}_2+c\norm{c_0}_\infty\norm{\grad u}_2\norm{v}_2\biggr)=\\ &=
            \sup_{i,j\in\{1,\dotsc,n\}}\norm{a_{ij}}_\infty\sum_{i=1}^n\norm[\bigg]{\drp{u}{x_i}}_2\sum_{j=1}^n\norm[\bigg]{\drp{v}{x_j}}_2+c\norm{c_0}_\infty\norm{\grad u}_2\norm{v}_2\le\\ &\le
            c'\sup_{i,j\in\{1,\dotsc,n\}}\norm{a_{ij}}_\infty\norm{u}_{\sobHc[1]{\Omega}}\norm{v}_{\sobHc[1]{\Omega}}+c\norm{c_0}_\infty\norm{u}_{\sobHc[1]{\Omega}}\norm{v}_{\sobHc[1]{\Omega}}
        \end{split}
    \end{equation}
    che prova la limitatezza e dunque la continuità di $a$.
    Per l'ellitticità, notiamo che
    \begin{equation}
        a(u,v)=
        \sum_{i=1}^n\sum_{j=1}^n\int_\Omega\drp{u}{x_i}\drp{u}{x_j}a_{ij}\,\dd\mu+\int_\Omega c_0u^2\,\dd\mu\ge
        % . . . qui manca qualcosa . . .
        \lambda\sum_{i=1}^n \int_\Omega\abs[\bigg]{\drp{u}{x_i}}^2\,\dd\mu=
        \lambda\norm{u}_{1,2}^2.\qedhere
    \end{equation}
\end{proof}
Questa proprietà indica inoltre che $u\mapsto\sqrt{a(u,u)}$ è una norma equivalente alle altre già viste su $\sobHc[1]{\Omega}$.
È anche simmetrica, perciò $a(u,v)$ è un prodotto interno su tale spazio.

Costruiamo quindi da questa forma bilineare il funzionale
\begin{equation}
    E_a\colon u\mapsto\frac12a(u,u)-\int_\Omega fu\,\dd\mu
    \label{eq:funzionale-energia-ellittico-dirichlet}
\end{equation}
associato al problema di Dirichlet \eqref{eq:problema-dirichlet-ellittico-omogeneo}.
Esso è tale che esiste $\bar{u}\in\sobHc[1]{\Omega}$ per cui
\begin{equation}
    \inf_{\sobHc[1]{\Omega}}E_a(u)=E_a(\bar{u})
\end{equation}
e $E_a'(\bar{u})[\phi]=0$ per ogni $\phi$; in sostanza il problema ammette una soluzione debole.

Come esempio di quanto abbiamo appena visto, consideriamo il problema di Dirichlet per l'equazione di Allen-Cahn
\begin{equation}
    \begin{cases}
        -\lap u+u^3-u=f & \text{in }\Omega\\
        u=0             & \text{su }\boundary\Omega
    \end{cases}
    \label{eq:problema-dirichlet-allen-cahn}
\end{equation}
a cui associamo il funzionale caratteristico (per $f\in\leb[2]{\Omega}$ fissata) $E_f\colon\sobHc[1]{\Omega}\to\R$ dato da
\begin{equation}
    E_f\colon u\mapsto
    \int_\Omega\biggl(\frac12\norm{\grad u}^2+\frac14u^4-\frac12u^2-fu\biggr)\,\dd\mu.
    \label{eq:funzionale-energia-allen-cahn}
\end{equation}
Sappiamo che per $1\le q\le\frac{2n}{n-2}$, dal teorema di Sobolev \ref{t:sobolev}, si ha $\sobHc[1]{\Omega}\emb\leb[q]{\Omega}$, quindi dovremo porre il problema in uno spazio $n$-dimensionale con $\frac{2n}{n-2}\ge 4$ affinch\'e $E_f$ sia ben definito: questo implica che $n\le 4$.
Se invece $\Omega\subset\R^3$ (ossia $n=3$, ma anche in dimensione più bassa) si ha $\frac{2n}{n-2}=6$ quindi si ha anche che $\sobHc[1]{\Omega}\cemb\leb[q]{\Omega}$ per il teorema di Rellich-Kondrachov \ref{t:rellich-kondrachov}.
Minimizziamo dunque il funzionale e verifichiamo che l'estremo inferiore sia anche un minimo.
Sicuramente $E_f$ è limitato dal basso poich\'e
\begin{equation}
    \begin{split}
        E_f(u)&\ge
        \int_\Omega\biggl(\frac12\norm{\grad u}^2+\frac14u^4-\frac12u^2\biggr)\,\dd\mu-\norm{f}_2\norm{u}_2=\\ &=
        \int_\Omega\biggl[\frac12\norm{\grad u}^2+\frac12u^2\biggl(\frac12u^2-1\biggr)\biggr]\,\dd\mu-\norm{f}_2\norm{u}_2
    \end{split}
\end{equation}
e detti $\mathcal{U}_+\defeq\{\vec x\in\Omega\colon\abs{u(\vec x)}>1\}$ e $\mathcal{U}_-\defeq\{\vec x\in\Omega\colon\abs{u(\vec x)}\le 1\}$ si ha
\begin{equation}
    \int_\Omega\frac12u^2\biggl(\frac12u^2-1\biggr)\,\dd\mu=
    \int_{\mathcal{U}_-}\frac12u^2\biggl(\frac12u^2-1\biggr)\,\dd\mu+\int_{\mathcal{U}_+}\frac12u^2\biggl(\frac12u^2-1\biggr)\,\dd\mu:
\end{equation}
il secondo termine non è mai negativo, mentre il primo è limitato da $C\mu(\Omega)$ per un $C>0$, dunque
\begin{equation}
    E_f(u)\ge\frac12\norm{u}_2^2-\norm{f}_2\norm{u}_2-C'
\end{equation}
per un certo $C'>0$.
Si può poi mostrare che quando $\norm{u}_2\to+\infty$ si ha $E_f(u)\to+\infty$, ossia che $L$ è coercitivo.
Possiamo cos\`i trovare una palla $\mathcal{B}=\{u\in\sobHc[1]{\Omega}\colon\norm{u}_2\le R\}$ tale che per $u\notin\mathcal{B}$ si abbia $E_f(u)\ge m+1$, dove $m\defeq\inf_{\sobHc[1]{\Omega}}E_f=\inf_\mathcal{B}E_f$.

Prendiamo dunque una successione $\{u_n\}_{n\in\N}$ minimizzante, ossia tale che $E_f(u_n)\to m$: sappiamo che $\norm{u_n}\le R$.
Esiste poi, per la riflessività dello spazio $\sobHc[1]{\Omega}$, una sottosuccessione $\{u_{n_k}\}$ tale per cui $\exists u\in\sobHc[1]{\Omega}$ tale che $u_{n_k}\weakto u$, quindi $E_f(u_{n_k})\to E_f(u)$.
Per il teorema di Rellich-Kondrachov \ref{t:rellich-kondrachov} dunque $u_{n_k}\to u$ in $\leb[q]{\Omega}$ per $q<\frac{2n}{n-2}$, ad esempio $q<4$.
Pertanto
\begin{equation}
    \int_\Omega u_n^4\,\dd\mu\to\norm{u}_4^4=\int_\Omega u^4\,\dd\mu
\end{equation}
e anche i successivi termini di $E_f(u_n)$ convergono, per la compattezza dell'immersione sia in $\leb[4]{\Omega}$ che in $\leb[2]{\Omega}$.
Rimane il gradiente di $u_n$, per il quale abbiamo
\begin{equation}
    \liminf_{n\to+\infty}\frac12\int_\Omega\norm{\grad u_n}^2\,\dd\mu\ge\frac12\int_\Omega\norm{\grad u}^2\,\dd\mu
\end{equation}
quindi
\begin{equation}
    \begin{split}
        m=\lim_{n\to+\infty} E_f(u_n)&=
        \lim_{n\to+\infty}\int_\Omega\frac12\norm{\grad u_n}^2\,\dd\mu+\int_\Omega\biggl(\frac14u_n^4-\frac12u_n^2-fu\biggr)\,\dd\mu\ge\\ &\ge
        \liminf_{n\to+\infty}\int_\Omega\frac12\norm{\grad u_n}^2\,\dd\mu+\int_\Omega\biggl(\frac14u_n^4-\frac12u_n^2-fu\biggr)\,\dd\mu\ge\\ &\ge
        \int_\Omega\biggl(\frac12\norm{\grad u}^2+\frac14u_n^4-\frac12u_n^2-fu\biggr)\,\dd\mu
    \end{split}
\end{equation}
che dimostra l'esistenza di una $\bar{u}\in\sobHc[1]{\Omega}$ tale che $E_f(\bar{u})=\min E_f$.
Prendiamo ora la derivata direzionale di $E_f$ in $\bar{u}$ lungo una $\phi\in\sobHc[1]{\Omega}\setminus\{0\}$: per $t\in\R$ sia $\alpha(t)\defeq E_f(\bar{u}+t\phi)$.
Tale $\alpha$ avrà un minimo in $t=0$, per quanto visto finora, quindi
\begin{equation}
    \begin{split}
        0=\alpha'(0)&=
        \lim_{t\to 0}\frac{E_f(\bar{u}+t\phi)-E_f(\bar{u})}{t}=\\ &=
        \lim_{t\to 0}\frac1{t}\biggl\{\int_\Omega\biggr[\frac12\norm{\grad(\bar{u}+t\phi)}^2+\frac14(\bar{u}+t\phi)^4-\frac12(\bar{u}+t\phi)^2-(\bar{u}'t\phi)f\biggr]\,\dd\mu-E_f(\bar{u})\biggr\}=\\ &=
        \lim_{t\to 0}\frac1{t}\int_\Omega\biggr[\frac122t\scalar{\grad\bar{u}}{\grad\phi}+t^2\norm{\grad\phi}^2-\frac12\biggl(2t\bar{u}\phi-\frac{t^2}2\phi^2\biggr)-tf\phi\biggr]\,\dd\mu=\\ &=
        \lim_{t\to 0}\int_\Omega\biggr(\scalar{\grad\bar{u}}{\grad\phi}+t\norm{\grad\phi}^2-\bar{u}\phi+\frac{t}4\phi^2-f\phi\biggr)\,\dd\mu=\\ &=
        \int_\Omega\biggr(\scalar{\grad\bar{u}}{\grad\phi}-\bar{u}\phi-f\phi\biggr)\,\dd\mu
    \end{split}
\end{equation}
quindi $\bar{u}$ è una soluzione debole del problema \eqref{eq:problema-dirichlet-allen-cahn}.

Possiamo generalizzare quanto detto finora a equazioni del tipo
\begin{equation}
    L(u)+g(u)=f
\end{equation}
dove $L$ è un operatore ellittico (come $-\lap$) e $g$, come funzione da $\R$ in $\R$, è continua e limitata da
\begin{equation}
    \abs{g(s)}\le c+d\abs{s}^p,
\end{equation}
ossia la sua crescita è al più polinomiale, per dei $c,d>0$ e $1\le p<\frac{n+2}{n-2}$ in modo da poter applicare le immersioni studiate.
Inoltre se $G(t)=\int_0^tg(s)\,\dd s$ allora $G\in\cclass[1]$
\begin{equation}
    \abs{G(s)}\le c'+d'\abs{s}^{p+1}
\end{equation}
per dei $c',d'>0$ e si ha $p+1<\frac{n+2}{n-2}+1=\frac{2n}{n-2}$, con la disuguaglianza stretta in modo da poter usare la compattezza dell'immersione.
Con queste ipotesi il funzionale associato all'equazione (che comunque non è univoco) è
\begin{equation}
    E\colon u\mapsto \int_\Omega\bigl[\norm{\grad u}^2+G(u)-fu\bigr]\,\dd\mu
\end{equation}
per $u\in\sobHc[1]{\Omega}$.
Aggiungendo l'ipotesi che il funzionale sia ``grande all'infinito'', ossia che diverga per $\norm{u}_{1,2}\to+\infty$, allora $\bar{u}$ è soluzione debole del problema se $E(\bar{u})=\min E$.
